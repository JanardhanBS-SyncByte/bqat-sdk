<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SDKServiceHelper.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">bqatsdk-services</a> &gt; <a href="index.source.html" class="el_package">io.bqat.sdk.services.service</a> &gt; <span class="el_source">SDKServiceHelper.java</span></div><h1>SDKServiceHelper.java</h1><pre class="source lang-java linenums">package io.bqat.sdk.services.service;

import static io.bqat.sdk.services.constant.AppConstants.LOGGER_IDTYPE;
import static io.bqat.sdk.services.constant.AppConstants.LOGGER_SESSIONID;

import java.io.IOException;

import org.json.JSONException;
import org.json.JSONObject;

import com.squareup.okhttp.MediaType;
import com.squareup.okhttp.OkHttpClient;
import com.squareup.okhttp.Request;
import com.squareup.okhttp.RequestBody;
import com.squareup.okhttp.Response;

import io.bqat.sdk.services.dto.BqatRequestDto;
import io.bqat.sdk.services.dto.SettingsDto;
import io.mosip.kernel.core.util.DateUtils;
import lombok.extern.slf4j.Slf4j;

<span class="fc" id="L22">@Slf4j</span>
public class SDKServiceHelper {
<span class="fc" id="L24">	private String REQ_TEMPLATE = &quot;{ \&quot;modality\&quot;: \&quot;%s\&quot;, \&quot;id\&quot;: \&quot;%s\&quot;, \&quot;type\&quot;: \&quot;%s\&quot;, \&quot;data\&quot;: \&quot;%s\&quot;, \&quot;requestTime\&quot;: \&quot;%s\&quot;, \&quot;version\&quot;: \&quot;%s\&quot;}&quot;;</span>

	private SettingsDto settingsDto;
	public SDKServiceHelper(SettingsDto settingsDto)
<span class="fc" id="L28">	{</span>
<span class="fc" id="L29">		this.settingsDto = settingsDto;</span>
<span class="fc" id="L30">	}</span>
	
	public JSONObject getQualityInfoWithJson(BqatRequestDto requestDto) {
<span class="fc" id="L33">		OkHttpClient client = new OkHttpClient();</span>
<span class="fc" id="L34">		String requestBody = String.format(REQ_TEMPLATE, requestDto.getModality(), requestDto.getId(), requestDto.getType(), requestDto.getData(),</span>
<span class="fc" id="L35">				DateUtils.getUTCCurrentDateTime(), &quot;1.0.0&quot;);</span>

		//logger.debug(LOGGER_SESSIONID, LOGGER_IDTYPE, &quot;requestBody&gt;&gt;&quot;, requestBody);
		
<span class="fc" id="L39">		MediaType mediaType = MediaType.parse(settingsDto.getContentType() + &quot;; charset=&quot; + settingsDto.getContentCharset());</span>
<span class="fc" id="L40">		RequestBody body = RequestBody.create(mediaType, requestBody);</span>
<span class="fc" id="L41">		Request request = new Request.Builder()</span>
<span class="fc" id="L42">				.url(&quot;http://&quot; + settingsDto.getServerIpAddress() + &quot;&quot; + settingsDto.getServerPort() + &quot;&quot; + settingsDto.getServerPath()).post(body).build();</span>
		try {
<span class="nc" id="L44">			Response response = client.newCall(request).execute();</span>
<span class="nc bnc" id="L45" title="All 2 branches missed.">			if (response.isSuccessful()) {</span>
<span class="nc" id="L46">				String jsonResponse = response.body().string();</span>
<span class="nc" id="L47">				log.debug(LOGGER_SESSIONID, LOGGER_IDTYPE, &quot;getQualityInfoWithJson&quot;, jsonResponse);</span>
<span class="nc" id="L48">				JSONObject jsonObject = new JSONObject(jsonResponse);</span>
<span class="nc" id="L49">				jsonObject = jsonObject.getJSONObject(settingsDto.getJsonResults());</span>
<span class="nc" id="L50">				return jsonObject;</span>
			}
<span class="fc" id="L52">		} catch (IOException | JSONException e) {</span>
<span class="fc" id="L53">			log.error(LOGGER_SESSIONID, LOGGER_IDTYPE, &quot;getQualityInfoWithJson&quot;, e);</span>
<span class="nc" id="L54">		}</span>
<span class="fc" id="L55">		return null;</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>