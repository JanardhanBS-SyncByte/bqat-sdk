<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SDKService.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">bqatsdk-services</a> &gt; <a href="index.source.html" class="el_package">io.bqat.sdk.services.service</a> &gt; <span class="el_source">SDKService.java</span></div><h1>SDKService.java</h1><pre class="source lang-java linenums">package io.bqat.sdk.services.service;

import static io.bqat.sdk.services.constant.AppConstants.LOGGER_IDTYPE;
import static io.bqat.sdk.services.constant.AppConstants.LOGGER_SESSIONID;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import io.bqat.sdk.services.constant.ResponseStatus;
import io.bqat.sdk.services.constant.SDKContstant;
import io.bqat.sdk.services.dto.BqatRequestDto;
import io.bqat.sdk.services.exceptions.BqatSdkException;
import io.bqat.sdk.services.utils.Utils;
import io.mosip.biometrics.util.ConvertRequestDto;
import io.mosip.biometrics.util.face.FaceBDIR;
import io.mosip.biometrics.util.face.FaceDecoder;
import io.mosip.biometrics.util.face.FaceISOStandardsValidator;
import io.mosip.biometrics.util.face.FaceQualityBlock;
import io.mosip.biometrics.util.face.ImageColourSpace;
import io.mosip.biometrics.util.face.ImageDataType;
import io.mosip.biometrics.util.face.LandmarkPoints;
import io.mosip.biometrics.util.finger.FingerBDIR;
import io.mosip.biometrics.util.finger.FingerCertificationBlock;
import io.mosip.biometrics.util.finger.FingerDecoder;
import io.mosip.biometrics.util.finger.FingerISOStandardsValidator;
import io.mosip.biometrics.util.finger.FingerImageCompressionType;
import io.mosip.biometrics.util.finger.FingerPosition;
import io.mosip.biometrics.util.finger.FingerQualityBlock;
import io.mosip.biometrics.util.iris.EyeLabel;
import io.mosip.biometrics.util.iris.ImageType;
import io.mosip.biometrics.util.iris.IrisBDIR;
import io.mosip.biometrics.util.iris.IrisDecoder;
import io.mosip.biometrics.util.iris.IrisISOStandardsValidator;
import io.mosip.biometrics.util.iris.IrisImageCompressionType;
import io.mosip.biometrics.util.iris.IrisQualityBlock;
import io.mosip.kernel.biometrics.constant.BiometricType;
import io.mosip.kernel.biometrics.constant.PurposeType;
import io.mosip.kernel.biometrics.entities.BIR;
import io.mosip.kernel.biometrics.entities.BiometricRecord;
import lombok.extern.slf4j.Slf4j;

<span class="fc" id="L44">@Slf4j</span>
<span class="fc" id="L45">public abstract class SDKService {</span>

	protected Map&lt;BiometricType, List&lt;BIR&gt;&gt; getBioSegmentMap(BiometricRecord record,
			List&lt;BiometricType&gt; modalitiesToMatch) {
<span class="fc" id="L49">		Boolean noFilter = false;</span>

		// if the modalities to match is not passed, assume that all modalities have to
		// be matched.
<span class="pc bpc" id="L53" title="2 of 4 branches missed.">		if (modalitiesToMatch == null || modalitiesToMatch.isEmpty())</span>
<span class="nc" id="L54">			noFilter = true;</span>

<span class="fc" id="L56">		Map&lt;BiometricType, List&lt;BIR&gt;&gt; bioSegmentMap = new HashMap&lt;&gt;();</span>
<span class="fc bfc" id="L57" title="All 2 branches covered.">		for (BIR segment : record.getSegments()) {</span>
<span class="fc" id="L58">			BiometricType bioType = segment.getBdbInfo().getType().get(0);</span>

			// ignore modalities that are not to be matched
<span class="pc bpc" id="L61" title="2 of 4 branches missed.">			if (noFilter == false &amp;&amp; !modalitiesToMatch.contains(bioType))</span>
<span class="nc" id="L62">				continue;</span>

<span class="pc bpc" id="L64" title="1 of 2 branches missed.">			if (!bioSegmentMap.containsKey(bioType)) {</span>
<span class="fc" id="L65">				bioSegmentMap.put(bioType, new ArrayList&lt;BIR&gt;());</span>
			}
<span class="fc" id="L67">			bioSegmentMap.get(bioType).add(segment);</span>
<span class="fc" id="L68">		}</span>

<span class="fc" id="L70">		return bioSegmentMap;</span>
	}

	protected boolean isValidBirData(BIR bir, BqatRequestDto bqatRequestDto) {
<span class="fc" id="L74">		BiometricType biometricType = bir.getBdbInfo().getType().get(0);</span>
<span class="fc" id="L75">		PurposeType purposeType = bir.getBdbInfo().getPurpose();</span>
<span class="fc" id="L76">		List&lt;String&gt; bioSubTypeList = bir.getBdbInfo().getSubtype();</span>

<span class="fc" id="L78">		String bioSubType = null;</span>
<span class="pc bpc" id="L79" title="2 of 4 branches missed.">		if (bioSubTypeList != null &amp;&amp; !bioSubTypeList.isEmpty()) {</span>
<span class="fc" id="L80">			bioSubType = bioSubTypeList.get(0).trim();</span>
<span class="pc bpc" id="L81" title="1 of 2 branches missed.">			if (bioSubTypeList.size() &gt;= 2)</span>
<span class="nc" id="L82">				bioSubType += &quot; &quot; + bioSubTypeList.get(1).trim();</span>
		}

<span class="pc bpc" id="L85" title="1 of 2 branches missed.">		if (!isValidBIRParams(bir, biometricType, bioSubType))</span>
<span class="nc" id="L86">			return false;</span>

<span class="pc bpc" id="L88" title="1 of 2 branches missed.">		if (!isValidBDBData(purposeType, biometricType, bioSubType, bir.getBdb(), bqatRequestDto))</span>
<span class="nc" id="L89">			return false;</span>

<span class="fc" id="L91">		return true;</span>
	}

	protected boolean isValidBIRParams(BIR segment, BiometricType bioType, String bioSubType) {
<span class="fc" id="L95">		ResponseStatus responseStatus = null;</span>
<span class="pc bpc" id="L96" title="1 of 4 branches missed.">		switch (bioType) {</span>
		case FACE:
<span class="fc" id="L98">			break;</span>
		case FINGER:
<span class="pc bpc" id="L100" title="1 of 4 branches missed.">			if (!(bioSubType.equals(&quot;UNKNOWN&quot;) || bioSubType.equals(&quot;Left IndexFinger&quot;)</span>
<span class="pc bpc" id="L101" title="2 of 4 branches missed.">					|| bioSubType.equals(&quot;Left RingFinger&quot;) || bioSubType.equals(&quot;Left MiddleFinger&quot;)</span>
<span class="pc bpc" id="L102" title="2 of 4 branches missed.">					|| bioSubType.equals(&quot;Left LittleFinger&quot;) || bioSubType.equals(&quot;Left Thumb&quot;)</span>
<span class="pc bpc" id="L103" title="3 of 4 branches missed.">					|| bioSubType.equals(&quot;Right IndexFinger&quot;) || bioSubType.equals(&quot;Right RingFinger&quot;)</span>
<span class="nc bnc" id="L104" title="All 4 branches missed.">					|| bioSubType.equals(&quot;Right MiddleFinger&quot;) || bioSubType.equals(&quot;Right LittleFinger&quot;)</span>
<span class="nc bnc" id="L105" title="All 2 branches missed.">					|| bioSubType.equals(&quot;Right Thumb&quot;))) {</span>
<span class="nc" id="L106">				log.error(LOGGER_SESSIONID, LOGGER_IDTYPE, &quot;isValidBIRParams&gt;&gt;BiometricType#&quot; + bioType + &quot;&gt;&gt;BioSubType#&quot; + bioSubType);</span>
<span class="nc" id="L107">				responseStatus = ResponseStatus.MISSING_INPUT;</span>
<span class="nc" id="L108">				throw new BqatSdkException(responseStatus.getStatusCode() + &quot;&quot;, responseStatus.getStatusMessage());</span>
			}
			break;
		case IRIS:
<span class="pc bpc" id="L112" title="4 of 6 branches missed.">			if (!(bioSubType.equals(&quot;UNKNOWN&quot;) || bioSubType.equals(&quot;Left&quot;) || bioSubType.equals(&quot;Right&quot;))) {</span>
<span class="nc" id="L113">				log.error(LOGGER_SESSIONID, LOGGER_IDTYPE, &quot;isValidBIRParams&gt;&gt;BiometricType#&quot; + bioType + &quot;&gt;&gt;BioSubType#&quot; + bioSubType);</span>
<span class="nc" id="L114">				responseStatus = ResponseStatus.MISSING_INPUT;</span>
<span class="nc" id="L115">				throw new BqatSdkException(responseStatus.getStatusCode() + &quot;&quot;, responseStatus.getStatusMessage());</span>
			}
			break;
		default:
<span class="nc" id="L119">			log.error(LOGGER_SESSIONID, LOGGER_IDTYPE, &quot;isValidBIRParams&gt;&gt;BiometricType#&quot; + bioType + &quot;&gt;&gt;BioSubType#&quot; + bioSubType);</span>
<span class="nc" id="L120">			responseStatus = ResponseStatus.MISSING_INPUT;</span>
<span class="nc" id="L121">			throw new BqatSdkException(responseStatus.getStatusCode() + &quot;&quot;, responseStatus.getStatusMessage());</span>
		}
<span class="fc" id="L123">		return true;</span>
	}

	protected boolean isValidBDBData(PurposeType purposeType, BiometricType bioType, String bioSubType,
			byte[] bdbData, BqatRequestDto bqatRequestDto) {
<span class="fc" id="L128">		ResponseStatus responseStatus = null;</span>

<span class="pc bpc" id="L130" title="2 of 4 branches missed.">		if (bdbData != null &amp;&amp; bdbData.length != 0) {</span>
<span class="fc" id="L131">			return isValidBiometericData(purposeType, bioType, bioSubType, Utils.encodeToURLSafeBase64(bdbData), bqatRequestDto);</span>
		}

<span class="nc" id="L134">		responseStatus = ResponseStatus.BIOMETRIC_NOT_FOUND_IN_CBEFF;</span>
<span class="nc" id="L135">		throw new BqatSdkException(responseStatus.getStatusCode() + &quot;&quot;, responseStatus.getStatusMessage());</span>
	}

	protected boolean isValidBiometericData(PurposeType purposeType, BiometricType bioType, String bioSubType,
			String bdbData, BqatRequestDto bqatRequestDto) {
<span class="fc" id="L140">		ResponseStatus responseStatus = null;</span>
<span class="pc bpc" id="L141" title="1 of 4 branches missed.">		switch (bioType) {</span>
		case FACE:
<span class="fc" id="L143">			return isValidFaceBdb(purposeType, bioSubType, bdbData, bqatRequestDto);</span>
		case FINGER:
<span class="fc" id="L145">			return isValidFingerBdb(purposeType, bioSubType, bdbData, bqatRequestDto);</span>
		case IRIS:
<span class="fc" id="L147">			return isValidIrisBdb(purposeType, bioSubType, bdbData, bqatRequestDto);</span>
		}
<span class="nc" id="L149">		responseStatus = ResponseStatus.INVALID_INPUT;</span>
<span class="nc" id="L150">		throw new BqatSdkException(responseStatus.getStatusCode() + &quot;&quot;, responseStatus.getStatusMessage());</span>
	}

	protected boolean isValidFingerBdb(PurposeType purposeType, String biometricSubType, String bdbData, BqatRequestDto bqatRequestDto) {
<span class="fc" id="L154">		ResponseStatus responseStatus = null;</span>
		try {
<span class="fc" id="L156">			StringBuilder message = new StringBuilder(</span>
					&quot;ISOStandardsValidator[ISO19794-4:2011] failed due to below issues:&quot;);
<span class="fc" id="L158">			boolean isValid = true;</span>

<span class="fc" id="L160">			ConvertRequestDto convertRequestDto = new ConvertRequestDto();</span>
<span class="fc" id="L161">			convertRequestDto.setModality(&quot;Finger&quot;);</span>
<span class="fc" id="L162">			convertRequestDto.setVersion(&quot;ISO19794_4_2011&quot;);</span>
<span class="fc" id="L163">			byte[] bioData = null;</span>
			try {
<span class="fc" id="L165">				bioData = Utils.decodeURLSafeBase64(bdbData);</span>
<span class="fc" id="L166">				convertRequestDto.setInputBytes(bioData);</span>
<span class="nc" id="L167">			} catch (Exception e) {</span>
<span class="nc" id="L168">				responseStatus = ResponseStatus.INVALID_INPUT;</span>
<span class="nc" id="L169">				throw new BqatSdkException(responseStatus.getStatusCode() + &quot;&quot;,</span>
<span class="nc" id="L170">						responseStatus.getStatusMessage() + &quot; Source not valid base64urlencoded&quot;);</span>
<span class="fc" id="L171">			}</span>

<span class="fc" id="L173">			FingerBDIR bdir = FingerDecoder.getFingerBDIR(convertRequestDto);</span>

<span class="pc bpc" id="L175" title="1 of 2 branches missed.">			if (!FingerISOStandardsValidator.getInstance().isValidFormatIdentifier(bdir.getFormatIdentifier())) {</span>
<span class="nc" id="L176">				message.append(</span>
						&quot;&lt;BR&gt;Invalid Format Identifier for Finger Modality, expected values[0x46495200], but received input value[&quot;
<span class="nc" id="L178">								+ String.format(&quot;0x%08X&quot;, bdir.getFormatIdentifier()) + &quot;]&quot;);</span>
<span class="nc" id="L179">				isValid = false;</span>
			}

<span class="pc bpc" id="L182" title="1 of 2 branches missed.">			if (!FingerISOStandardsValidator.getInstance().isValidVersionNumber(bdir.getVersionNumber())) {</span>
<span class="nc" id="L183">				message.append(</span>
						&quot;&lt;BR&gt;Invalid Version Number for Finger Modality, expected values[0x30323000], but received input value[&quot;
<span class="nc" id="L185">								+ String.format(&quot;0x%08X&quot;, bdir.getVersionNumber()) + &quot;]&quot;);</span>
<span class="nc" id="L186">				isValid = false;</span>
			}

<span class="pc bpc" id="L189" title="1 of 2 branches missed.">			if (!FingerISOStandardsValidator.getInstance().isValidNoOfRepresentations(bdir.getNoOfRepresentations())) {</span>
<span class="nc" id="L190">				message.append(</span>
						&quot;&lt;BR&gt;Invalid No Of Representations for Finger Modality, expected values[0x0001], but received input value[&quot;
<span class="nc" id="L192">								+ String.format(&quot;0x%04X&quot;, bdir.getNoOfRepresentations()) + &quot;]&quot;);</span>
<span class="nc" id="L193">				isValid = false;</span>
			}

<span class="pc bpc" id="L196" title="2 of 4 branches missed.">			if (!FingerISOStandardsValidator.getInstance().isValidRecordLength(bioData != null ? bioData.length : 0,</span>
<span class="fc" id="L197">					bdir.getRecordLength())) {</span>
<span class="nc" id="L198">				message.append(</span>
						&quot;&lt;BR&gt;Invalid Record Length for Finger Modality, expected values between[0x00000039 and 0xFFFFFFFF], but received input value[&quot;
<span class="nc bnc" id="L200" title="All 2 branches missed.">								+ String.format(&quot;0x%08X&quot;, (bioData != null ? bioData.length : 0) + &quot;]&quot;));</span>
<span class="nc" id="L201">				isValid = false;</span>
			}

<span class="pc bpc" id="L204" title="1 of 2 branches missed.">			if (!FingerISOStandardsValidator.getInstance().isValidCertificationFlag(bdir.getCertificationFlag())) {</span>
<span class="nc" id="L205">				message.append(</span>
						&quot;&lt;BR&gt;Invalid Certification Flag for Finger Modality, expected values[0x00, 0x01], but received input value[&quot;
<span class="nc" id="L207">								+ String.format(&quot;0x%02X&quot;, bdir.getCertificationFlag()) + &quot;]&quot;);</span>
<span class="nc" id="L208">				isValid = false;</span>
			}

<span class="pc bpc" id="L211" title="1 of 2 branches missed.">			if (!FingerISOStandardsValidator.getInstance().isValidNoOfFingerPresent(bdir.getNoOfFingerPresent())) {</span>
<span class="nc" id="L212">				message.append(</span>
						&quot;&lt;BR&gt;Invalid No Of Finger Present for Finger Modality, expected values[0x01], but received input value[&quot;
<span class="nc" id="L214">								+ String.format(&quot;0x%02X&quot;, bdir.getNoOfFingerPresent()) + &quot;]&quot;);</span>
<span class="nc" id="L215">				isValid = false;</span>
			}

<span class="fc" id="L218">			if (!FingerISOStandardsValidator.getInstance()</span>
<span class="pc bpc" id="L219" title="1 of 2 branches missed.">					.isValidRepresentationLength(bdir.getRepresentationsLength())) {</span>
<span class="nc" id="L220">				message.append(</span>
						&quot;&lt;BR&gt;Invalid Representation Length for Finger Modality, expected values between[0x00000029 and 0xFFFFFFEF], but received input value[&quot;
<span class="nc" id="L222">								+ String.format(&quot;0x%08X&quot;, bdir.getRecordLength()) + &quot;]&quot;);</span>
<span class="nc" id="L223">				isValid = false;</span>
			}

<span class="pc bpc" id="L226" title="1 of 2 branches missed.">			if (!FingerISOStandardsValidator.getInstance().isValidCaptureDateTime(bdir.getCaptureYear(),</span>
<span class="fc" id="L227">					bdir.getCaptureMonth(), bdir.getCaptureDay(), bdir.getCaptureHour(), bdir.getCaptureMinute(),</span>
<span class="fc" id="L228">					bdir.getCaptureSecond(), bdir.getCaptureMilliSecond())) {</span>
<span class="nc" id="L229">				message.append(</span>
						&quot;&lt;BR&gt;Invalid CaptureDateTime for Finger Modality, The capture date and time field shall \r\n&quot;
								+ &quot;indicate when the capture of this \r\n&quot; + &quot;representation stated in Coordinated \r\n&quot;
								+ &quot;Universal Time (UTC). The capture date \r\n&quot;
								+ &quot;and time field shall consist of 9 bytes., but received input value[&quot;
<span class="nc" id="L234">								+ bdir.getCaptureDateTime() + &quot;]&quot;);</span>
<span class="nc" id="L235">				isValid = false;</span>
			}

<span class="fc" id="L238">			if (!FingerISOStandardsValidator.getInstance()</span>
<span class="pc bpc" id="L239" title="1 of 2 branches missed.">					.isValidCaptureDeviceTechnologyIdentifier(bdir.getCaptureDeviceTechnologyIdentifier())) {</span>
<span class="nc" id="L240">				message.append(</span>
						&quot;&lt;BR&gt;Invalid Capture Device Technology Identifier for Finger Modality, expected values between[0x00 and 0x14], but received input value[&quot;
<span class="nc" id="L242">								+ String.format(&quot;0x%02X&quot;, bdir.getCaptureDeviceTechnologyIdentifier()) + &quot;]&quot;);</span>
<span class="nc" id="L243">				isValid = false;</span>
			}

<span class="fc" id="L246">			if (!FingerISOStandardsValidator.getInstance()</span>
<span class="pc bpc" id="L247" title="1 of 2 branches missed.">					.isValidCaptureDeviceVendor(bdir.getCaptureDeviceVendorIdentifier())) {</span>
<span class="nc" id="L248">				message.append(</span>
						&quot;&lt;BR&gt;Invalid Capture Device Vendor Identifier for Finger Modality, expected values between[0x0000 and 0xFFFF], but received input value[&quot;
<span class="nc" id="L250">								+ String.format(&quot;0x%04X&quot;, bdir.getCaptureDeviceVendorIdentifier()) + &quot;]&quot;);</span>
<span class="nc" id="L251">				isValid = false;</span>
			}

<span class="pc bpc" id="L254" title="1 of 2 branches missed.">			if (!FingerISOStandardsValidator.getInstance().isValidCaptureDeviceType(</span>
<span class="fc" id="L255">					bdir.getCaptureDeviceVendorIdentifier(), bdir.getCaptureDeviceTypeIdentifier())) {</span>
<span class="nc" id="L256">				message.append(</span>
						&quot;&lt;BR&gt;Invalid Capture Device Type Identifier for Finger Modality, expected values between[0x0000 and 0xFFFF], but received input value[&quot;
<span class="nc" id="L258">								+ String.format(&quot;0x%04X&quot;, bdir.getCaptureDeviceTypeIdentifier()) + &quot;]&quot;);</span>
<span class="nc" id="L259">				isValid = false;</span>
			}

<span class="pc bpc" id="L262" title="1 of 2 branches missed.">			if (!FingerISOStandardsValidator.getInstance().isValidNoOfQualityBlocks(bdir.getNoOfQualityBlocks())) {</span>
<span class="nc" id="L263">				message.append(</span>
						&quot;&lt;BR&gt;Invalid No Of Quality Blocks value for Finger Modality, expected values between[0x00 and 0xFF], but received input value[&quot;
<span class="nc" id="L265">								+ String.format(&quot;0x%02X&quot;, bdir.getNoOfQualityBlocks()) + &quot;]&quot;);</span>
<span class="nc" id="L266">				isValid = false;</span>
			}

<span class="pc bpc" id="L269" title="1 of 2 branches missed.">			if (bdir.getNoOfQualityBlocks() &gt; 0) {</span>
<span class="fc bfc" id="L270" title="All 2 branches covered.">				for (FingerQualityBlock qualityBlock : bdir.getQualityBlocks()) {</span>
<span class="fc" id="L271">					if (!FingerISOStandardsValidator.getInstance()</span>
<span class="pc bpc" id="L272" title="1 of 2 branches missed.">							.isValidQualityScore(qualityBlock.getQualityScore())) {</span>
<span class="nc" id="L273">						message.append(</span>
								&quot;&lt;BR&gt;Invalid Quality Score value for Finger Modality, expected values between[{0x00 and 0x64}, {0xFF}], but received input value[&quot;
<span class="nc" id="L275">										+ String.format(&quot;0x%02X&quot;, qualityBlock.getQualityScore()) + &quot;]&quot;);</span>
<span class="nc" id="L276">						isValid = false;</span>
					}

<span class="fc" id="L279">					if (!FingerISOStandardsValidator.getInstance()</span>
<span class="pc bpc" id="L280" title="1 of 2 branches missed.">							.isValidQualityAlgorithmIdentifier(qualityBlock.getQualityAlgorithmIdentifier())) {</span>
<span class="nc" id="L281">						message.append(</span>
								&quot;&lt;BR&gt;Invalid Quality Algorithm Identifier for Finger Modality, expected values between[0x0000 and 0xFFFF], but received input value[&quot;
<span class="nc" id="L283">										+ String.format(&quot;0x%04X&quot;, qualityBlock.getQualityAlgorithmIdentifier()) + &quot;]&quot;);</span>
<span class="nc" id="L284">						isValid = false;</span>
					}

<span class="pc bpc" id="L287" title="1 of 2 branches missed.">					if (!FingerISOStandardsValidator.getInstance().isValidQualityAlgorithmVendorIdentifier(</span>
<span class="fc" id="L288">							qualityBlock.getQualityAlgorithmVendorIdentifier())) {</span>
<span class="nc" id="L289">						message.append(</span>
								&quot;&lt;BR&gt;Invalid Quality Algorithm Vendor Identifier for Finger Modality, expected values between[0x0000 and 0xFFFF], but received input value[&quot;
<span class="nc" id="L291">										+ String.format(&quot;0x%04X&quot;, qualityBlock.getQualityAlgorithmVendorIdentifier())</span>
										+ &quot;]&quot;);
<span class="nc" id="L293">						isValid = false;</span>
					}
				}
			}

<span class="fc" id="L298">			if (!FingerISOStandardsValidator.getInstance()</span>
<span class="pc bpc" id="L299" title="1 of 2 branches missed.">					.isValidNoOfCertificationBlocks(bdir.getNoOfCertificationBlocks())) {</span>
<span class="nc" id="L300">				message.append(</span>
						&quot;&lt;BR&gt;Invalid No Of Certification Blocks for Finger Modality, expected values between[0x00 and 0xFF], but received input value[&quot;
<span class="nc" id="L302">								+ String.format(&quot;0x%02X&quot;, bdir.getNoOfCertificationBlocks()) + &quot;]&quot;);</span>
<span class="nc" id="L303">				isValid = false;</span>
			}

<span class="pc bpc" id="L306" title="1 of 2 branches missed.">			if (bdir.getNoOfCertificationBlocks() &gt; 0) {</span>
<span class="nc bnc" id="L307" title="All 2 branches missed.">				for (FingerCertificationBlock fingerCertificationBlock : bdir.getCertificationBlocks()) {</span>
<span class="nc" id="L308">					if (!FingerISOStandardsValidator.getInstance()</span>
<span class="nc bnc" id="L309" title="All 2 branches missed.">							.isValidCertificationAuthorityID(fingerCertificationBlock.getCertificationAuthorityID())) {</span>
<span class="nc" id="L310">						message.append(</span>
								&quot;&lt;BR&gt;Invalid Certification AuthorityID for Finger Modality, expected values between[0x0000 and 0xFFFF], but received input value[&quot;
<span class="nc" id="L312">										+ String.format(&quot;0x%04X&quot;,</span>
<span class="nc" id="L313">												fingerCertificationBlock.getCertificationAuthorityID())</span>
										+ &quot;]&quot;);
<span class="nc" id="L315">						isValid = false;</span>
					}

<span class="nc bnc" id="L318" title="All 2 branches missed.">					if (!FingerISOStandardsValidator.getInstance().isValidCertificationSchemeIdentifier(</span>
<span class="nc" id="L319">							fingerCertificationBlock.getCertificationSchemeIdentifier())) {</span>
<span class="nc" id="L320">						message.append(</span>
								&quot;&lt;BR&gt;Invalid Certification Scheme Identifier for Finger Modality, expected values between[0x00 and 0xFF], but received input value[&quot;
<span class="nc" id="L322">										+ String.format(&quot;0x%02X&quot;,</span>
<span class="nc" id="L323">												fingerCertificationBlock.getCertificationSchemeIdentifier())</span>
										+ &quot;]&quot;);
<span class="nc" id="L325">						isValid = false;</span>
					}
				}
			}

<span class="fc" id="L330">			int fingerPosition = bdir.getFingerPosition();</span>
<span class="pc bpc" id="L331" title="1 of 2 branches missed.">			if (!isValidFingerPosition(fingerPosition, biometricSubType)) {</span>
<span class="nc" id="L332">				message.append(</span>
						&quot;&lt;BR&gt;Invalid Finger Position Value for Finger Modality, expected values between[0x00 and 0x0A], but received input value[&quot;
<span class="nc" id="L334">								+ String.format(&quot;0x%02X&quot;, bdir.getFingerPosition()) + &quot;}]&quot;);</span>
<span class="nc" id="L335">				isValid = false;</span>
			}

<span class="pc bpc" id="L338" title="1 of 2 branches missed.">			if (!FingerISOStandardsValidator.getInstance().isValidRepresentationsNo(bdir.getRepresentationNo())) {</span>
<span class="nc" id="L339">				message.append(</span>
						&quot;&lt;BR&gt;Invalid Representations No Value for Finger Modality, expected values between[0x00 and 0x0F], but received input value[&quot;
<span class="nc" id="L341">								+ String.format(&quot;0x%02X&quot;, bdir.getRepresentationNo()) + &quot;]&quot;);</span>
<span class="nc" id="L342">				isValid = false;</span>
			}

			// Used to check the image based on PIXELS_PER_INCH or PIXELS_PER_CM
<span class="fc" id="L346">			int scaleUnitsType = bdir.getScaleUnits();</span>
<span class="pc bpc" id="L347" title="1 of 2 branches missed.">			if (!FingerISOStandardsValidator.getInstance().isValidScaleUnits(scaleUnitsType)) {</span>
<span class="nc" id="L348">				message.append(</span>
						&quot;&lt;BR&gt;Invalid Scale Unit Type Value for Finger Modality, expected values[0x01, 0x02], but received input value[&quot;
<span class="nc" id="L350">								+ String.format(&quot;0x%02X&quot;, scaleUnitsType) + &quot;]&quot;);</span>
<span class="nc" id="L351">				isValid = false;</span>
			}

<span class="fc" id="L354">			int scanSpatialSamplingRateHorizontal = bdir.getCaptureDeviceSpatialSamplingRateHorizontal();</span>
<span class="fc" id="L355">			if (!FingerISOStandardsValidator.getInstance()</span>
<span class="pc bpc" id="L356" title="1 of 2 branches missed.">					.isValidScanSpatialSamplingRateHorizontal(scanSpatialSamplingRateHorizontal)) {</span>
<span class="nc" id="L357">				message.append(</span>
						&quot;&lt;BR&gt;Invalid Device Scan Spatial Sampling Rate Horizontal for Finger Modality, expected values between[0x01EA and 0x03F2], but received input value[&quot;
<span class="nc" id="L359">								+ String.format(&quot;0x%04X&quot;, scanSpatialSamplingRateHorizontal) + &quot;]&quot;);</span>
<span class="nc" id="L360">				isValid = false;</span>
			}

<span class="fc" id="L363">			int scanSpatialSamplingRateVertical = bdir.getCaptureDeviceSpatialSamplingRateVertical();</span>
<span class="fc" id="L364">			if (!FingerISOStandardsValidator.getInstance()</span>
<span class="pc bpc" id="L365" title="1 of 2 branches missed.">					.isValidScanSpatialSamplingRateVertical(scanSpatialSamplingRateVertical)) {</span>
<span class="nc" id="L366">				message.append(</span>
						&quot;&lt;BR&gt;Invalid Device Scan Spatial Sampling Rate Vertical for Finger Modality, expected values between[0x01EA and 0x03F2], but received input value[&quot;
<span class="nc" id="L368">								+ String.format(&quot;0x%04X&quot;, scanSpatialSamplingRateVertical) + &quot;]&quot;);</span>
<span class="nc" id="L369">				isValid = false;</span>
			}

<span class="pc bpc" id="L372" title="1 of 2 branches missed.">			if (!FingerISOStandardsValidator.getInstance().isValidImageSpatialSamplingRateHorizontal(</span>
<span class="fc" id="L373">					scanSpatialSamplingRateHorizontal, bdir.getImageSpatialSamplingRateHorizontal())) {</span>
<span class="nc" id="L374">				message.append(</span>
						&quot;&lt;BR&gt;Invalid Image Spatial SamplingRate Horizontal for Finger Modality, expected values between[0x01EA and 0x03F2] And less than or equal to ScanSpatialSamplingRateHorizontal value of &quot;
<span class="nc" id="L376">								+ String.format(&quot;0x%04X&quot;, scanSpatialSamplingRateHorizontal)</span>
								+ &quot;, but received input value[&quot;
<span class="nc" id="L378">								+ String.format(&quot;0x%04X&quot;, bdir.getImageSpatialSamplingRateHorizontal()) + &quot;]&quot;);</span>
<span class="nc" id="L379">				isValid = false;</span>
			}

<span class="pc bpc" id="L382" title="1 of 2 branches missed.">			if (!FingerISOStandardsValidator.getInstance().isValidImageSpatialSamplingRateVertical(</span>
<span class="fc" id="L383">					scanSpatialSamplingRateVertical, bdir.getImageSpatialSamplingRateVertical())) {</span>
<span class="nc" id="L384">				message.append(</span>
						&quot;&lt;BR&gt;Invalid Device Scan Spatial Sampling Rate Vertical for Finger Modality, expected values between[0x01EA and 0x03F2] And less than or equal to ScanSpatialSamplingRateVertical value of &quot;
<span class="nc" id="L386">								+ String.format(&quot;0x%04X&quot;, scanSpatialSamplingRateVertical)</span>
								+ &quot;, but received input value[&quot;
<span class="nc" id="L388">								+ String.format(&quot;0x%04X&quot;, bdir.getImageSpatialSamplingRateVertical()) + &quot;]&quot;);</span>
<span class="nc" id="L389">				isValid = false;</span>
			}

<span class="fc" id="L392">			byte[] inImageData = bdir.getImage();</span>

<span class="pc bpc" id="L394" title="1 of 2 branches missed.">			if (!FingerISOStandardsValidator.getInstance().isValidBitDepth(inImageData, bdir.getBitDepth())) {</span>
<span class="nc" id="L395">				message.append(</span>
						&quot;&lt;BR&gt;Invalid Image Bit Depth Value for Finger Modality, expected values[0x08], but received input value[&quot;
<span class="nc" id="L397">								+ String.format(&quot;0x%02X&quot;, bdir.getBitDepth()) + &quot;]&quot;);</span>
<span class="nc" id="L398">				isValid = false;</span>
			}

<span class="fc" id="L401">			int compressionType = bdir.getCompressionType();</span>
<span class="pc bpc" id="L402" title="2 of 6 branches missed.">			if (!(compressionType == FingerImageCompressionType.JPEG_2000_LOSSY</span>
					|| compressionType == FingerImageCompressionType.WSQ
					|| compressionType == FingerImageCompressionType.JPEG_2000_LOSS_LESS)) {
<span class="nc" id="L405">				message.append(</span>
						&quot;&lt;BR&gt;Invalid Image Compression Type for Finger Modality, expected values[{JPEG_2000_LOSSY(0x04) or WSQ(0x02) or JPEG_2000_LOSS_LESS(0x05)}], but received input value[&quot;
<span class="nc" id="L407">								+ &quot; (&quot; + String.format(&quot;0x%02X&quot;, compressionType) + &quot;)]&quot;);</span>
<span class="nc" id="L408">				isValid = false;</span>
			}

<span class="fc" id="L411">			bqatRequestDto.setModality(SDKContstant.MODALITY_FINGERPRINT);</span>
<span class="fc" id="L412">			bqatRequestDto.setId(SDKContstant.MODALITY_FINGERPRINT + &quot;_&quot; + biometricSubType + &quot;_&quot;+ System.currentTimeMillis());</span>
<span class="fc bfc" id="L413" title="All 2 branches covered.">			bqatRequestDto.setType(compressionType == FingerImageCompressionType.WSQ ? SDKContstant.DATATYPE_WSQ : SDKContstant.DATATYPE_JP2);</span>
<span class="fc" id="L414">			bqatRequestDto.setData(Utils.encodeToURLSafeBase64(inImageData));</span>
		
<span class="pc bpc" id="L416" title="1 of 2 branches missed.">			if (!FingerISOStandardsValidator.getInstance().isValidImageImpressionType(bdir.getImpressionType())) {</span>
<span class="nc" id="L417">				message.append(</span>
						&quot;&lt;BR&gt;Invalid Image Impression Type for Finger Modality, expected values between[{0x00 and 0x0F} or 0x18 or 0x1C or 0x1D], &quot;
<span class="nc" id="L419">								+ &quot; but received input value[&quot; + String.format(&quot;0x%02X&quot;, bdir.getImpressionType())</span>
								+ &quot;]&quot;);
<span class="nc" id="L421">				isValid = false;</span>
			}

<span class="pc bpc" id="L424" title="1 of 2 branches missed.">			if (!FingerISOStandardsValidator.getInstance().isValidImageDataLength(inImageData, bdir.getImageLength())) {</span>
<span class="nc" id="L425">				message.append(</span>
						&quot;&lt;BR&gt;Invalid Image Data Length for Finger Modality, expected values[0x00000001 and 0xFFFFFFFF], but received input value[&quot;
<span class="nc" id="L427">								+ String.format(&quot;0x%08X&quot;, bdir.getImageLength()) + &quot;]&quot;);</span>
<span class="nc" id="L428">				isValid = false;</span>
			}
			// TODO check the condition: imagedata
			// can check imagettype for auth and reg
<span class="pc bpc" id="L432" title="1 of 2 branches missed.">			if (!isValid) {</span>
<span class="nc" id="L433">				responseStatus = ResponseStatus.INVALID_INPUT;</span>
<span class="nc" id="L434">				throw new BqatSdkException(responseStatus.getStatusCode() + &quot;&quot;,</span>
<span class="nc" id="L435">						responseStatus.getStatusMessage() + &quot; &quot; + message.toString());</span>
			}
<span class="fc" id="L437">			return true;</span>
<span class="nc" id="L438">		} catch (Exception ex) {</span>
<span class="nc" id="L439">			responseStatus = ResponseStatus.INVALID_INPUT;</span>
<span class="nc" id="L440">			throw new BqatSdkException(responseStatus.getStatusCode() + &quot;&quot;,</span>
<span class="nc" id="L441">					responseStatus.getStatusMessage() + &quot; &quot; + ex.getLocalizedMessage());</span>
		}
	}

	protected boolean isValidFingerPosition(int fingerPosition, String biometricSubType) {
<span class="fc" id="L446">		boolean isValid = false;</span>
<span class="pc bpc" id="L447" title="10 of 12 branches missed.">		switch (biometricSubType) {</span>
		case &quot;UNKNOWN&quot;:
<span class="nc" id="L449">			isValid = true;</span>
<span class="nc" id="L450">			break;</span>
		case &quot;Left IndexFinger&quot;:
<span class="pc bpc" id="L452" title="1 of 2 branches missed.">			if (fingerPosition == FingerPosition.LEFT_INDEX_FINGER)</span>
<span class="fc" id="L453">				isValid = true;</span>
			break;
		case &quot;Left MiddleFinger&quot;:
<span class="nc bnc" id="L456" title="All 2 branches missed.">			if (fingerPosition == FingerPosition.LEFT_MIDDLE_FINGER)</span>
<span class="nc" id="L457">				isValid = true;</span>
			break;
		case &quot;Left RingFinger&quot;:
<span class="nc bnc" id="L460" title="All 2 branches missed.">			if (fingerPosition == FingerPosition.LEFT_RING_FINGER)</span>
<span class="nc" id="L461">				isValid = true;</span>
			break;
		case &quot;Left LittleFinger&quot;:
<span class="nc bnc" id="L464" title="All 2 branches missed.">			if (fingerPosition == FingerPosition.LEFT_LITTLE_FINGER)</span>
<span class="nc" id="L465">				isValid = true;</span>
			break;
		case &quot;Left Thumb&quot;:
<span class="nc bnc" id="L468" title="All 2 branches missed.">			if (fingerPosition == FingerPosition.LEFT_THUMB)</span>
<span class="nc" id="L469">				isValid = true;</span>
			break;
		case &quot;Right IndexFinger&quot;:
<span class="pc bpc" id="L472" title="1 of 2 branches missed.">			if (fingerPosition == FingerPosition.RIGHT_INDEX_FINGER)</span>
<span class="fc" id="L473">				isValid = true;</span>
			break;
		case &quot;Right MiddleFinger&quot;:
<span class="nc bnc" id="L476" title="All 2 branches missed.">			if (fingerPosition == FingerPosition.RIGHT_MIDDLE_FINGER)</span>
<span class="nc" id="L477">				isValid = true;</span>
			break;
		case &quot;Right RingFinger&quot;:
<span class="nc bnc" id="L480" title="All 2 branches missed.">			if (fingerPosition == FingerPosition.RIGHT_RING_FINGER)</span>
<span class="nc" id="L481">				isValid = true;</span>
			break;
		case &quot;Right LittleFinger&quot;:
<span class="nc bnc" id="L484" title="All 2 branches missed.">			if (fingerPosition == FingerPosition.RIGHT_LITTLE_FINGER)</span>
<span class="nc" id="L485">				isValid = true;</span>
			break;
		case &quot;Right Thumb&quot;:
<span class="nc bnc" id="L488" title="All 2 branches missed.">			if (fingerPosition == FingerPosition.RIGHT_THUMB)</span>
<span class="nc" id="L489">				isValid = true;</span>
			break;
		default:
<span class="nc" id="L492">			isValid = false;</span>
			break;
		}
<span class="fc" id="L495">		return isValid;</span>
	}

	protected boolean isValidIrisBdb(PurposeType purposeType, String biometricSubType, String bdbData, BqatRequestDto bqatRequestDto) {
<span class="fc" id="L499">		ResponseStatus responseStatus = null;</span>
		try {
<span class="fc" id="L501">			StringBuilder message = new StringBuilder(</span>
					&quot;ISOStandardsValidator[ISO19794-6:2011] failed due to below issues:&quot;);
<span class="fc" id="L503">			boolean isValid = true;</span>

<span class="fc" id="L505">			ConvertRequestDto convertRequestDto = new ConvertRequestDto();</span>
<span class="fc" id="L506">			convertRequestDto.setModality(&quot;Iris&quot;);</span>
<span class="fc" id="L507">			convertRequestDto.setVersion(&quot;ISO19794_6_2011&quot;);</span>
<span class="fc" id="L508">			byte[] bioData = null;</span>
			try {
<span class="fc" id="L510">				bioData = Utils.decodeURLSafeBase64(bdbData);</span>
<span class="fc" id="L511">				convertRequestDto.setInputBytes(bioData);</span>
<span class="nc" id="L512">			} catch (Exception e) {</span>
<span class="nc" id="L513">				responseStatus = ResponseStatus.INVALID_INPUT;</span>
<span class="nc" id="L514">				throw new BqatSdkException(responseStatus.getStatusCode() + &quot;&quot;,</span>
<span class="nc" id="L515">						responseStatus.getStatusMessage() + &quot; Source not valid base64urlencoded&quot;);</span>
<span class="fc" id="L516">			}</span>

<span class="fc" id="L518">			IrisBDIR bdir = IrisDecoder.getIrisBDIR(convertRequestDto);</span>

<span class="pc bpc" id="L520" title="1 of 2 branches missed.">			if (!IrisISOStandardsValidator.getInstance().isValidFormatIdentifier(bdir.getFormatIdentifier())) {</span>
<span class="nc" id="L521">				message.append(</span>
						&quot;&lt;BR&gt;Invalid Format Identifier for Iris Modality, expected values[0x49495200], but received input value[&quot;
<span class="nc" id="L523">								+ String.format(&quot;0x%08X&quot;, bdir.getFormatIdentifier()) + &quot;]&quot;);</span>
<span class="nc" id="L524">				isValid = false;</span>
			}

<span class="pc bpc" id="L527" title="1 of 2 branches missed.">			if (!IrisISOStandardsValidator.getInstance().isValidVersionNumber(bdir.getVersionNumber())) {</span>
<span class="nc" id="L528">				message.append(</span>
						&quot;&lt;BR&gt;Invalid Version Number for Iris Modality, expected values[0x30323000], but received input value[&quot;
<span class="nc" id="L530">								+ String.format(&quot;0x%08X&quot;, bdir.getVersionNumber()) + &quot;]&quot;);</span>
<span class="nc" id="L531">				isValid = false;</span>
			}

<span class="fc" id="L534">			int noOfRepresentations = bdir.getNoOfRepresentations();</span>
<span class="pc bpc" id="L535" title="1 of 2 branches missed.">			if (!IrisISOStandardsValidator.getInstance().isValidNoOfRepresentations(noOfRepresentations)) {</span>
<span class="nc" id="L536">				message.append(</span>
						&quot;&lt;BR&gt;Invalid No Of Representations for Iris Modality, expected values[0x0001], but received input value[&quot;
<span class="nc" id="L538">								+ String.format(&quot;0x%04X&quot;, bdir.getNoOfRepresentations()) + &quot;]&quot;);</span>
<span class="nc" id="L539">				isValid = false;</span>
			}

<span class="pc bpc" id="L542" title="2 of 4 branches missed.">			if (!IrisISOStandardsValidator.getInstance().isValidRecordLength(bioData != null ? bioData.length : 0,</span>
<span class="fc" id="L543">					bdir.getRecordLength())) {</span>
<span class="nc" id="L544">				message.append(</span>
						&quot;&lt;BR&gt;Invalid Record Length for Iris Modality, expected values between[0x00000045 and 0xFFFFFFFF], but received input value[&quot;
<span class="nc bnc" id="L546" title="All 2 branches missed.">								+ String.format(&quot;0x%08X&quot;, (bioData != null ? bioData.length : 0) + &quot;]&quot;));</span>
<span class="nc" id="L547">				isValid = false;</span>
			}

<span class="pc bpc" id="L550" title="1 of 2 branches missed.">			if (!IrisISOStandardsValidator.getInstance().isValidCertificationFlag(bdir.getCertificationFlag())) {</span>
<span class="nc" id="L551">				message.append(</span>
						&quot;&lt;BR&gt;Invalid Certification Flag for Iris Modality, expected values[0x00], but received input value[&quot;
<span class="nc" id="L553">								+ String.format(&quot;0x%02X&quot;, bdir.getCertificationFlag()) + &quot;]&quot;);</span>
<span class="nc" id="L554">				isValid = false;</span>
			}

<span class="fc" id="L557">			int noOfEyesPresent = bdir.getNoOfEyesPresent();</span>
<span class="pc bpc" id="L558" title="1 of 2 branches missed.">			if (!IrisISOStandardsValidator.getInstance().isValidNoOfEyesRepresented(bdir.getNoOfEyesPresent())) {</span>
<span class="nc" id="L559">				message.append(</span>
						&quot;&lt;BR&gt;Invalid No Of Eyes Present for Iris Modality, expected values[0x00, 0x01], but received input value[&quot;
<span class="nc" id="L561">								+ String.format(&quot;0x%02X&quot;, bdir.getNoOfEyesPresent()) + &quot;]&quot;);</span>
<span class="nc" id="L562">				isValid = false;</span>
			}

<span class="pc bpc" id="L565" title="1 of 2 branches missed.">			if (noOfRepresentations != noOfEyesPresent) {</span>
<span class="nc" id="L566">				message.append(&quot;&lt;BR&gt;Invalid No Of Eyes Present[&quot; + String.format(&quot;0x%04X&quot;, noOfEyesPresent)</span>
						+ &quot;] for Iris Modality, For given No Of Representations[&quot;
<span class="nc" id="L568">						+ String.format(&quot;0x%04X&quot;, noOfRepresentations) + &quot;]&quot;);</span>
<span class="nc" id="L569">				isValid = false;</span>
			}

<span class="pc bpc" id="L572" title="1 of 2 branches missed.">			if (!IrisISOStandardsValidator.getInstance().isValidRepresentationLength(bdir.getRepresentationsLength())) {</span>
<span class="nc" id="L573">				message.append(</span>
						&quot;&lt;BR&gt;Invalid Representation Length for Iris Modality, expected values between[0x00000035 And 0xFFFFFFEF], but received input value[&quot;
<span class="nc" id="L575">								+ String.format(&quot;0x%08X&quot;, bdir.getRecordLength()) + &quot;]&quot;);</span>
<span class="nc" id="L576">				isValid = false;</span>
			}

<span class="pc bpc" id="L579" title="1 of 2 branches missed.">			if (!IrisISOStandardsValidator.getInstance().isValidCaptureDateTime(bdir.getCaptureYear(),</span>
<span class="fc" id="L580">					bdir.getCaptureMonth(), bdir.getCaptureDay(), bdir.getCaptureHour(), bdir.getCaptureMinute(),</span>
<span class="fc" id="L581">					bdir.getCaptureSecond(), bdir.getCaptureMilliSecond())) {</span>
<span class="nc" id="L582">				message.append(</span>
						&quot;&lt;BR&gt;Invalid CaptureDateTime for Iris Modality, The capture date and time field shall \r\n&quot;
								+ &quot;indicate when the capture of this \r\n&quot; + &quot;representation stated in Coordinated \r\n&quot;
								+ &quot;Universal Time (UTC). The capture date \r\n&quot;
								+ &quot;and time field shall consist of 9 bytes., but received input value[&quot;
<span class="nc" id="L587">								+ bdir.getCaptureDateTime() + &quot;]&quot;);</span>
<span class="nc" id="L588">				isValid = false;</span>
			}

<span class="fc" id="L591">			if (!IrisISOStandardsValidator.getInstance()</span>
<span class="pc bpc" id="L592" title="1 of 2 branches missed.">					.isValidCaptureDeviceTechnologyIdentifier(bdir.getCaptureDeviceTechnologyIdentifier())) {</span>
<span class="nc" id="L593">				message.append(</span>
						&quot;&lt;BR&gt;Invalid Capture Device Technology Identifier for Iris Modality, expected values[0x00, 0x01], but received input value[&quot;
<span class="nc" id="L595">								+ String.format(&quot;0x%02X&quot;, bdir.getCaptureDeviceTechnologyIdentifier()) + &quot;]&quot;);</span>
<span class="nc" id="L596">				isValid = false;</span>
			}

<span class="fc" id="L599">			if (!IrisISOStandardsValidator.getInstance()</span>
<span class="pc bpc" id="L600" title="1 of 2 branches missed.">					.isValidCaptureDeviceVendor(bdir.getCaptureDeviceVendorIdentifier())) {</span>
<span class="nc" id="L601">				message.append(</span>
						&quot;&lt;BR&gt;Invalid Capture Device Vendor Identifier for Iris Modality, expected values between[0x0000 and 0xFFFF], but received input value[&quot;
<span class="nc" id="L603">								+ String.format(&quot;0x%04X&quot;, bdir.getCaptureDeviceVendorIdentifier()) + &quot;]&quot;);</span>
<span class="nc" id="L604">				isValid = false;</span>
			}

<span class="pc bpc" id="L607" title="1 of 2 branches missed.">			if (!IrisISOStandardsValidator.getInstance().isValidCaptureDeviceType(</span>
<span class="fc" id="L608">					bdir.getCaptureDeviceVendorIdentifier(), bdir.getCaptureDeviceTypeIdentifier())) {</span>
<span class="nc" id="L609">				message.append(</span>
						&quot;&lt;BR&gt;Invalid Capture Device Type Identifier for Iris Modality, expected values between[0x0000 and 0xFFFF], but received input value[&quot;
<span class="nc" id="L611">								+ String.format(&quot;0x%04X&quot;, bdir.getCaptureDeviceTypeIdentifier()) + &quot;]&quot;);</span>
<span class="nc" id="L612">				isValid = false;</span>
			}

<span class="pc bpc" id="L615" title="1 of 2 branches missed.">			if (!IrisISOStandardsValidator.getInstance().isValidNoOfQualityBlocks(bdir.getNoOfQualityBlocks())) {</span>
<span class="nc" id="L616">				message.append(</span>
						&quot;&lt;BR&gt;Invalid No Of Quality Blocks value for Iris Modality, expected values between [0x00 and 0xFF], but received input value[&quot;
<span class="nc" id="L618">								+ String.format(&quot;0x%02X&quot;, bdir.getNoOfQualityBlocks()) + &quot;]&quot;);</span>
<span class="nc" id="L619">				isValid = false;</span>
			}

<span class="pc bpc" id="L622" title="1 of 2 branches missed.">			if (bdir.getNoOfQualityBlocks() &gt; 0) {</span>
<span class="fc bfc" id="L623" title="All 2 branches covered.">				for (IrisQualityBlock qualityBlock : bdir.getQualityBlocks()) {</span>
<span class="pc bpc" id="L624" title="1 of 2 branches missed.">					if (!IrisISOStandardsValidator.getInstance().isValidQualityScore(qualityBlock.getQualityScore())) {</span>
<span class="nc" id="L625">						message.append(</span>
								&quot;&lt;BR&gt;Invalid Quality Score value for Iris Modality, expected values between[0x00 and 0x64], but received input value[&quot;
<span class="nc" id="L627">										+ String.format(&quot;0x%02X&quot;, qualityBlock.getQualityScore()) + &quot;]&quot;);</span>
<span class="nc" id="L628">						isValid = false;</span>
					}

<span class="fc" id="L631">					if (!IrisISOStandardsValidator.getInstance()</span>
<span class="pc bpc" id="L632" title="1 of 2 branches missed.">							.isValidQualityAlgorithmIdentifier(qualityBlock.getQualityAlgorithmIdentifier())) {</span>
<span class="nc" id="L633">						message.append(</span>
								&quot;&lt;BR&gt;Invalid Quality Algorithm Identifier for Iris Modality, expected values between[0x0000 and 0xFFFF], but received input value[&quot;
<span class="nc" id="L635">										+ String.format(&quot;0x%04X&quot;, qualityBlock.getQualityAlgorithmIdentifier()) + &quot;]&quot;);</span>
<span class="nc" id="L636">						isValid = false;</span>
					}

<span class="pc bpc" id="L639" title="1 of 2 branches missed.">					if (!IrisISOStandardsValidator.getInstance().isValidQualityAlgorithmVendorIdentifier(</span>
<span class="fc" id="L640">							qualityBlock.getQualityAlgorithmVendorIdentifier())) {</span>
<span class="nc" id="L641">						message.append(</span>
								&quot;&lt;BR&gt;Invalid Quality Algorithm Vendor Identifier for Iris Modality, expected values between[0x0000 and 0xFFFF], but received input value[&quot;
<span class="nc" id="L643">										+ String.format(&quot;0x%04X&quot;, qualityBlock.getQualityAlgorithmVendorIdentifier())</span>
										+ &quot;]&quot;);
<span class="nc" id="L645">						isValid = false;</span>
					}
				}
			}

<span class="pc bpc" id="L650" title="1 of 2 branches missed.">			if (!IrisISOStandardsValidator.getInstance().isValidNoOfRepresentation(bdir.getRepresentationNo())) {</span>
<span class="nc" id="L651">				message.append(</span>
						&quot;&lt;BR&gt;Invalid No Of Representation for Iris Modality, expected values[0x01], but received input value[&quot;
<span class="nc" id="L653">								+ String.format(&quot;0x%02X&quot;, bdir.getRepresentationNo()) + &quot;]&quot;);</span>
<span class="nc" id="L654">				isValid = false;</span>
			}

<span class="fc" id="L657">			int eyeLabel = bdir.getEyeLabel();</span>
<span class="pc bpc" id="L658" title="1 of 2 branches missed.">			if (!isValidEyeLabel(eyeLabel, biometricSubType)) {</span>
<span class="nc" id="L659">				message.append(</span>
						&quot;&lt;BR&gt;Invalid Iris Eye Label Value for Iris Modality, expected values[0x00, 0x01, 0x02}], but received input value[&quot;
<span class="nc" id="L661">								+ &quot;{&quot; + String.format(&quot;0x%02X&quot;, bdir.getEyeLabel()) + &quot;}]&quot;);</span>
<span class="nc" id="L662">				isValid = false;</span>
			}

<span class="fc" id="L665">			int imageType = bdir.getImageType();</span>
<span class="pc bpc" id="L666" title="2 of 4 branches missed.">			if (!(imageType == ImageType.CROPPED_AND_MASKED || imageType == ImageType.CROPPED)) {</span>
<span class="nc" id="L667">				message.append(</span>
						&quot;&lt;BR&gt;Invalid Image Type No Value Irisnger Modality, expected values[0x03, 0x07], but received input value[&quot;
<span class="nc" id="L669">								+ &quot;{&quot; + String.format(&quot;0x%02X&quot;, bdir.getImageType()) + &quot;}]&quot;);</span>
<span class="nc" id="L670">				isValid = false;</span>
			}

<span class="pc bpc" id="L673" title="1 of 2 branches missed.">			if (!IrisISOStandardsValidator.getInstance().isValidImageFromat(bdir.getImageFormat())) {</span>
<span class="nc" id="L674">				message.append(</span>
						&quot;&lt;BR&gt;Invalid Image Format Value for Iris Modality, expected values[0x0A], but received input value[&quot;
<span class="nc" id="L676">								+ String.format(&quot;0x%02X&quot;, bdir.getImageFormat()) + &quot;]&quot;);</span>
<span class="nc" id="L677">				isValid = false;</span>
			}

<span class="fc" id="L680">			if (!IrisISOStandardsValidator.getInstance()</span>
<span class="pc bpc" id="L681" title="1 of 2 branches missed.">					.isValidImageHorizontalOrientation(bdir.getHorizontalOrientation())) {</span>
<span class="nc" id="L682">				message.append(</span>
						&quot;&lt;BR&gt;Invalid Image Horizontal Orientation for Iris Modality, expected values[0x00, 0x01, 0x02], but received input value[&quot;
<span class="nc" id="L684">								+ String.format(&quot;0x%02X&quot;, bdir.getHorizontalOrientation()) + &quot;]&quot;);</span>
<span class="nc" id="L685">				isValid = false;</span>
			}

<span class="fc" id="L688">			if (!IrisISOStandardsValidator.getInstance()</span>
<span class="pc bpc" id="L689" title="1 of 2 branches missed.">					.isValidImageVerticalOrientation(bdir.getVerticalOrientation())) {</span>
<span class="nc" id="L690">				message.append(</span>
						&quot;&lt;BR&gt;Invalid Image Vertical Orientation for Iris Modality, expected values[0x00, 0x01, 0x02], but received input value[&quot;
<span class="nc" id="L692">								+ String.format(&quot;0x%02X&quot;, bdir.getVerticalOrientation()) + &quot;]&quot;);</span>
<span class="nc" id="L693">				isValid = false;</span>
			}

<span class="fc" id="L696">			int compressionType = bdir.getCompressionType();</span>
<span class="pc bpc" id="L697" title="2 of 4 branches missed.">			if (!(compressionType == IrisImageCompressionType.JPEG_LOSSY</span>
					|| compressionType == IrisImageCompressionType.JPEG_LOSSLESS_OR_NONE)) {
<span class="nc" id="L699">				message.append(</span>
						&quot;&lt;BR&gt;Invalid Image Compression Type for Iris Modality, expected values[JPEG_2000_LOSSY(0x02), JPEG_2000_LOSS_LESS(0x01)], but received input value[&quot;
<span class="nc" id="L701">								+ &quot;(&quot; + String.format(&quot;0x%02X&quot;, compressionType) + &quot;)]&quot;);</span>
<span class="nc" id="L702">				isValid = false;</span>
			}

<span class="fc" id="L705">			byte[] inImageData = bdir.getImage();</span>
<span class="fc" id="L706">			bqatRequestDto.setModality(SDKContstant.MODALITY_IRIS);</span>
<span class="fc" id="L707">			bqatRequestDto.setId(SDKContstant.MODALITY_IRIS + &quot;_&quot; + biometricSubType + &quot;_&quot;+ System.currentTimeMillis());</span>
<span class="fc" id="L708">			bqatRequestDto.setType(SDKContstant.DATATYPE_JP2);</span>
<span class="fc" id="L709">			bqatRequestDto.setData(Utils.encodeToURLSafeBase64(inImageData));</span>

<span class="pc bpc" id="L711" title="1 of 2 branches missed.">			if (!IrisISOStandardsValidator.getInstance().isValidBitDepth(inImageData, bdir.getBitDepth())) {</span>
<span class="nc" id="L712">				message.append(</span>
						&quot;&lt;BR&gt;Invalid Image Bit Depth Value for Iris Modality, expected values[0x08(Grayscale)], but received input value[&quot;
<span class="nc" id="L714">								+ String.format(&quot;0x%02X&quot;, bdir.getBitDepth()) + &quot;]&quot;);</span>
<span class="nc" id="L715">				isValid = false;</span>
			}

<span class="pc bpc" id="L718" title="1 of 2 branches missed.">			if (!IrisISOStandardsValidator.getInstance().isValidRange(bdir.getRange())) {</span>
<span class="nc" id="L719">				message.append(</span>
						&quot;&lt;BR&gt;Invalid Range Value for Iris Modality, expected values between[0x0000 and 0xFFFF], but received input value[&quot;
<span class="nc" id="L721">								+ String.format(&quot;0x%04X&quot;, bdir.getRange()) + &quot;]&quot;);</span>
<span class="nc" id="L722">				isValid = false;</span>
			}

<span class="pc bpc" id="L725" title="1 of 2 branches missed.">			if (!IrisISOStandardsValidator.getInstance().isValidRollAngleOfEye(bdir.getRollAngleOfEye())) {</span>
<span class="nc" id="L726">				message.append(</span>
						&quot;&lt;BR&gt;Invalid Roll Angle Of Eye Value for Iris Modality, expected values between[0x0000 and 0xFFFF], but received input value[&quot;
<span class="nc" id="L728">								+ String.format(&quot;0x%04X&quot;, bdir.getRollAngleOfEye()) + &quot;]&quot;);</span>
<span class="nc" id="L729">				isValid = false;</span>
			}

<span class="pc bpc" id="L732" title="1 of 2 branches missed.">			if (!IrisISOStandardsValidator.getInstance().isValidRollAngleUncertainty(bdir.getRollAngleUncertainty())) {</span>
<span class="nc" id="L733">				message.append(</span>
						&quot;&lt;BR&gt;Invalid Roll Angle Uncertainty Value for Iris Modality, expected values between[0x0000 and 0xFFFF], but received input value[&quot;
<span class="nc" id="L735">								+ String.format(&quot;0x%04X&quot;, bdir.getRollAngleUncertainty()) + &quot;]&quot;);</span>
<span class="nc" id="L736">				isValid = false;</span>
			}

<span class="pc bpc" id="L739" title="1 of 2 branches missed.">			if (!IrisISOStandardsValidator.getInstance().isValidIrisCenterSmallestX(bdir.getIrisCenterSmallestX())) {</span>
<span class="nc" id="L740">				message.append(</span>
						&quot;&lt;BR&gt;Invalid Iris Center Smallest X Value for Iris Modality, expected values between[0x0000 and 0xFFFF], but received input value[&quot;
<span class="nc" id="L742">								+ String.format(&quot;0x%04X&quot;, bdir.getIrisCenterSmallestX()) + &quot;]&quot;);</span>
<span class="nc" id="L743">				isValid = false;</span>
			}

<span class="pc bpc" id="L746" title="1 of 2 branches missed.">			if (!IrisISOStandardsValidator.getInstance().isValidIrisCenterLargestX(bdir.getIrisCenterLargestX())) {</span>
<span class="nc" id="L747">				message.append(</span>
						&quot;&lt;BR&gt;Invalid Iris Center Largest X Value for Iris Modality, expected values between[0x0000 and 0xFFFF], but received input value[&quot;
<span class="nc" id="L749">								+ String.format(&quot;0x%04X&quot;, bdir.getIrisCenterLargestX()) + &quot;]&quot;);</span>
<span class="nc" id="L750">				isValid = false;</span>
			}

<span class="pc bpc" id="L753" title="1 of 2 branches missed.">			if (!IrisISOStandardsValidator.getInstance().isValidIrisCenterSmallestY(bdir.getIrisCenterSmallestY())) {</span>
<span class="nc" id="L754">				message.append(</span>
						&quot;&lt;BR&gt;Invalid Iris Center Smallest Y Value for Iris Modality, expected values between[0x0000 and 0xFFFF], but received input value[&quot;
<span class="nc" id="L756">								+ String.format(&quot;0x%04X&quot;, bdir.getIrisCenterSmallestY()) + &quot;]&quot;);</span>
<span class="nc" id="L757">				isValid = false;</span>
			}

<span class="pc bpc" id="L760" title="1 of 2 branches missed.">			if (!IrisISOStandardsValidator.getInstance().isValidIrisCenterLargestY(bdir.getIrisCenterLargestY())) {</span>
<span class="nc" id="L761">				message.append(</span>
						&quot;&lt;BR&gt;Invalid Iris Center Largest Y Value for Iris Modality, expected values between[0x0000 and 0xFFFF], but received input value[&quot;
<span class="nc" id="L763">								+ String.format(&quot;0x%04X&quot;, bdir.getIrisCenterLargestY()) + &quot;]&quot;);</span>
<span class="nc" id="L764">				isValid = false;</span>
			}

<span class="pc bpc" id="L767" title="1 of 2 branches missed.">			if (!IrisISOStandardsValidator.getInstance().isValidIrisDiameterSmallest(bdir.getIrisDiameterSmallest())) {</span>
<span class="nc" id="L768">				message.append(</span>
						&quot;&lt;BR&gt;Invalid Iris Diameter Smallest Value for Iris Modality, expected values between[0x0000 and 0xFFFF], but received input value[&quot;
<span class="nc" id="L770">								+ String.format(&quot;0x%04X&quot;, bdir.getIrisDiameterSmallest()) + &quot;]&quot;);</span>
<span class="nc" id="L771">				isValid = false;</span>
			}

<span class="pc bpc" id="L774" title="1 of 2 branches missed.">			if (!IrisISOStandardsValidator.getInstance().isValidIrisDiameterLargest(bdir.getIrisDiameterLargest())) {</span>
<span class="nc" id="L775">				message.append(</span>
						&quot;&lt;BR&gt;Invalid Iris Diameter Largest Value for Iris Modality, expected values between[0x0000 and 0xFFFF], but received input value[&quot;
<span class="nc" id="L777">								+ String.format(&quot;0x%04X&quot;, bdir.getIrisDiameterLargest()) + &quot;]&quot;);</span>
<span class="nc" id="L778">				isValid = false;</span>
			}

<span class="pc bpc" id="L781" title="1 of 2 branches missed.">			if (!IrisISOStandardsValidator.getInstance().isValidImageDataLength(inImageData, bdir.getImageLength())) {</span>
<span class="nc" id="L782">				message.append(</span>
						&quot;&lt;BR&gt;Invalid Image Data Length for Iris Modality, expected values between[0x00000001 and 0xFFFFFFFF], but received input value[&quot;
<span class="nc" id="L784">								+ String.format(&quot;0x%08X&quot;, bdir.getImageLength()) + &quot;]&quot;);</span>
<span class="nc" id="L785">				isValid = false;</span>
			}

			// TODO check the condition: imagedata
<span class="pc bpc" id="L789" title="1 of 2 branches missed.">			if (!isValid) {</span>
<span class="nc" id="L790">				responseStatus = ResponseStatus.INVALID_INPUT;</span>
<span class="nc" id="L791">				throw new BqatSdkException(responseStatus.getStatusCode() + &quot;&quot;,</span>
<span class="nc" id="L792">						responseStatus.getStatusMessage() + &quot; &quot; + message.toString());</span>
			}
			// can check imagettype for auth and reg
<span class="fc" id="L795">			return true;</span>
<span class="nc" id="L796">		} catch (Exception ex) {</span>
<span class="nc" id="L797">			responseStatus = ResponseStatus.INVALID_INPUT;</span>
<span class="nc" id="L798">			throw new BqatSdkException(responseStatus.getStatusCode() + &quot;&quot;,</span>
<span class="nc" id="L799">					responseStatus.getStatusMessage() + &quot; &quot; + ex.getLocalizedMessage());</span>
		}
	}

	protected boolean isValidEyeLabel(int eyeLabel, String biometricSubType) {
<span class="fc" id="L804">		boolean isValid = false;</span>
<span class="pc bpc" id="L805" title="3 of 4 branches missed.">		switch (biometricSubType) {</span>
		case &quot;UNKNOWN&quot;:
<span class="nc" id="L807">			isValid = true;</span>
<span class="nc" id="L808">			break;</span>
		case &quot;Left&quot;:
<span class="pc bpc" id="L810" title="1 of 2 branches missed.">			if (eyeLabel == EyeLabel.LEFT)</span>
<span class="fc" id="L811">				isValid = true;</span>
			break;
		case &quot;Right&quot;:
<span class="nc bnc" id="L814" title="All 2 branches missed.">			if (eyeLabel == EyeLabel.RIGHT)</span>
<span class="nc" id="L815">				isValid = true;</span>
			break;
		default:
<span class="nc" id="L818">			isValid = false;</span>
			break;
		}
<span class="fc" id="L821">		return isValid;</span>
	}

	protected boolean isValidFaceBdb(PurposeType purposeType, String biometricSubType, String bdbData, BqatRequestDto bqatRequestDto) {
<span class="fc" id="L825">		ResponseStatus responseStatus = null;</span>
		try {
<span class="fc" id="L827">			StringBuilder message = new StringBuilder(</span>
					&quot;ISOStandardsValidator[ISO19794-5:2011] failed due to below issues:&quot;);
<span class="fc" id="L829">			boolean isValid = true;</span>

<span class="fc" id="L831">			ConvertRequestDto convertRequestDto = new ConvertRequestDto();</span>
<span class="fc" id="L832">			convertRequestDto.setModality(&quot;Face&quot;);</span>
<span class="fc" id="L833">			convertRequestDto.setVersion(&quot;ISO19794_5_2011&quot;);</span>
<span class="fc" id="L834">			byte[] bioData = null;</span>
			try {
<span class="fc" id="L836">				bioData = Utils.decodeURLSafeBase64(bdbData);</span>
<span class="fc" id="L837">				convertRequestDto.setInputBytes(bioData);</span>
<span class="nc" id="L838">			} catch (Exception e) {</span>
<span class="nc" id="L839">				responseStatus = ResponseStatus.INVALID_INPUT;</span>
<span class="nc" id="L840">				throw new BqatSdkException(responseStatus.getStatusCode() + &quot;&quot;, responseStatus.getStatusMessage());</span>
<span class="fc" id="L841">			}</span>
<span class="fc" id="L842">			FaceBDIR bdir = FaceDecoder.getFaceBDIR(convertRequestDto);</span>

<span class="pc bpc" id="L844" title="1 of 2 branches missed.">			if (!FaceISOStandardsValidator.getInstance().isValidFormatIdentifier(bdir.getFormatIdentifier())) {</span>
<span class="nc" id="L845">				message.append(</span>
						&quot;&lt;BR&gt;Invalid Format Identifier for Face Modality, expected values[0x46414300], but received input value[&quot;
<span class="nc" id="L847">								+ String.format(&quot;0x%08X&quot;, bdir.getFormatIdentifier()) + &quot;]&quot;);</span>
<span class="nc" id="L848">				isValid = false;</span>
			}

<span class="pc bpc" id="L851" title="1 of 2 branches missed.">			if (!FaceISOStandardsValidator.getInstance().isValidVersionNumber(bdir.getVersionNumber())) {</span>
<span class="nc" id="L852">				message.append(</span>
						&quot;&lt;BR&gt;Invalid Version Number for Face Modality, expected values[0x30333000], but received input value[&quot;
<span class="nc" id="L854">								+ String.format(&quot;0x%08X&quot;, bdir.getVersionNumber()) + &quot;]&quot;);</span>
<span class="nc" id="L855">				isValid = false;</span>
			}

<span class="pc bpc" id="L858" title="1 of 2 branches missed.">			if (!FaceISOStandardsValidator.getInstance().isValidNoOfRepresentations(bdir.getNoOfRepresentations())) {</span>
<span class="nc" id="L859">				message.append(</span>
						&quot;&lt;BR&gt;Invalid No Of Representations for Face Modality, expected values[0x0001], but received input value[&quot;
<span class="nc" id="L861">								+ String.format(&quot;0x%04X&quot;, bdir.getNoOfRepresentations()) + &quot;]&quot;);</span>
<span class="nc" id="L862">				isValid = false;</span>
			}

<span class="pc bpc" id="L865" title="2 of 4 branches missed.">			if (!FaceISOStandardsValidator.getInstance().isValidRecordLength(bioData != null ? bioData.length : 0,</span>
<span class="fc" id="L866">					bdir.getRecordLength())) {</span>
<span class="nc" id="L867">				message.append(</span>
						&quot;&lt;BR&gt;Invalid Record Length for Face Modality, expected values between[0x00000001 and 0xFFFFFFFF], but received input value[&quot;
<span class="nc bnc" id="L869" title="All 2 branches missed.">								+ String.format(&quot;0x%08X&quot;, (bioData != null ? bioData.length : 0) + &quot;]&quot;));</span>
<span class="nc" id="L870">				isValid = false;</span>
			}

<span class="pc bpc" id="L873" title="1 of 2 branches missed.">			if (!FaceISOStandardsValidator.getInstance().isValidCertificationFlag(bdir.getCertificationFlag())) {</span>
<span class="nc" id="L874">				message.append(</span>
						&quot;&lt;BR&gt;Invalid Certification Flag for Face Modality, expected values[0x00], but received input value[&quot;
<span class="nc" id="L876">								+ String.format(&quot;0x%02X&quot;, bdir.getCertificationFlag()) + &quot;]&quot;);</span>
<span class="nc" id="L877">				isValid = false;</span>
			}

<span class="pc bpc" id="L880" title="1 of 2 branches missed.">			if (!FaceISOStandardsValidator.getInstance().isValidTemporalSemantics(bdir.getTemporalSemantics())) {</span>
<span class="nc" id="L881">				message.append(</span>
						&quot;&lt;BR&gt;Invalid Certification Flag for Face Modality, expected values[0x0000], but received input value[&quot;
<span class="nc" id="L883">								+ String.format(&quot;0x%04X&quot;, bdir.getTemporalSemantics()) + &quot;]&quot;);</span>
<span class="nc" id="L884">				isValid = false;</span>
			}

<span class="pc bpc" id="L887" title="1 of 2 branches missed.">			if (!FaceISOStandardsValidator.getInstance().isValidRepresentationLength(bdir.getRecordLength())) {</span>
<span class="nc" id="L888">				message.append(</span>
						&quot;&lt;BR&gt;Invalid Representation Length for Face Modality, expected values between[0x00000033 and 0xFFFFFFEF], but received input value[&quot;
<span class="nc" id="L890">								+ String.format(&quot;0x%08X&quot;, bdir.getRecordLength()) + &quot;]&quot;);</span>
<span class="nc" id="L891">				isValid = false;</span>
			}

<span class="pc bpc" id="L894" title="1 of 2 branches missed.">			if (!FaceISOStandardsValidator.getInstance().isValidCaptureDateTime(bdir.getCaptureYear(),</span>
<span class="fc" id="L895">					bdir.getCaptureMonth(), bdir.getCaptureDay(), bdir.getCaptureHour(), bdir.getCaptureMinute(),</span>
<span class="fc" id="L896">					bdir.getCaptureSecond(), bdir.getCaptureMilliSecond())) {</span>
<span class="nc" id="L897">				message.append(</span>
						&quot;&lt;BR&gt;Invalid CaptureDateTime for Face Modality, The capture date and time field shall \r\n&quot;
								+ &quot;indicate when the capture of this \r\n&quot; + &quot;representation stated in Coordinated \r\n&quot;
								+ &quot;Universal Time (UTC). The capture date \r\n&quot;
								+ &quot;and time field shall consist of 9 bytes., but received input value[&quot;
<span class="nc" id="L902">								+ bdir.getCaptureDateTime() + &quot;]&quot;);</span>
<span class="nc" id="L903">				isValid = false;</span>
			}

<span class="fc" id="L906">			if (!FaceISOStandardsValidator.getInstance()</span>
<span class="pc bpc" id="L907" title="1 of 2 branches missed.">					.isValidCaptureDeviceTechnologyIdentifier(bdir.getCaptureDeviceTechnologyIdentifier())) {</span>
<span class="nc" id="L908">				message.append(</span>
						&quot;&lt;BR&gt;Invalid Capture Device Technology Identifier for Face Modality, expected values between[{0x00 and 0x06}, {0x80 and 0xFF}], but received input value[&quot;
<span class="nc" id="L910">								+ String.format(&quot;0x%02X&quot;, bdir.getCaptureDeviceTechnologyIdentifier()) + &quot;]&quot;);</span>
<span class="nc" id="L911">				isValid = false;</span>
			}

<span class="fc" id="L914">			if (!FaceISOStandardsValidator.getInstance()</span>
<span class="pc bpc" id="L915" title="1 of 2 branches missed.">					.isValidCaptureDeviceVendor(bdir.getCaptureDeviceVendorIdentifier())) {</span>
<span class="nc" id="L916">				message.append(</span>
						&quot;&lt;BR&gt;Invalid Capture Device Vendor Identifier for Face Modality, expected values between[0x0000 and 0xFFFF], but received input value[&quot;
<span class="nc" id="L918">								+ String.format(&quot;0x%04X&quot;, bdir.getCaptureDeviceVendorIdentifier()) + &quot;]&quot;);</span>
<span class="nc" id="L919">				isValid = false;</span>
			}

<span class="pc bpc" id="L922" title="1 of 2 branches missed.">			if (!FaceISOStandardsValidator.getInstance().isValidCaptureDeviceType(</span>
<span class="fc" id="L923">					bdir.getCaptureDeviceVendorIdentifier(), bdir.getCaptureDeviceTypeIdentifier())) {</span>
<span class="nc" id="L924">				message.append(</span>
						&quot;&lt;BR&gt;Invalid Capture Device Type Identifier for Face Modality, expected values between[0x0000 and 0xFFFF], but received input value[&quot;
<span class="nc" id="L926">								+ String.format(&quot;0x%04X&quot;, bdir.getCaptureDeviceTypeIdentifier()) + &quot;]&quot;);</span>
<span class="nc" id="L927">				isValid = false;</span>
			}

<span class="pc bpc" id="L930" title="1 of 2 branches missed.">			if (!FaceISOStandardsValidator.getInstance().isValidNoOfQualityBlocks(bdir.getNoOfQualityBlocks())) {</span>
<span class="nc" id="L931">				message.append(</span>
						&quot;&lt;BR&gt;Invalid No Of Quality Blocks value for Face Modality, expected values between[0x00 and 0xFF], but received input value[&quot;
<span class="nc" id="L933">								+ String.format(&quot;0x%02X&quot;, bdir.getNoOfQualityBlocks()) + &quot;]&quot;);</span>
<span class="nc" id="L934">				isValid = false;</span>
			}

<span class="pc bpc" id="L937" title="1 of 2 branches missed.">			if (bdir.getNoOfQualityBlocks() &gt; 0) {</span>
<span class="fc bfc" id="L938" title="All 2 branches covered.">				for (FaceQualityBlock qualityBlock : bdir.getQualityBlocks()) {</span>
<span class="pc bpc" id="L939" title="1 of 2 branches missed.">					if (!FaceISOStandardsValidator.getInstance().isValidQualityScore(qualityBlock.getQualityScore())) {</span>
<span class="nc" id="L940">						message.append(</span>
								&quot;&lt;BR&gt;Invalid Quality Score value for Face Modality, expected values between[{0x00 and 0x64}, {0xFF}], but received input value[&quot;
<span class="nc" id="L942">										+ String.format(&quot;0x%02X&quot;, qualityBlock.getQualityScore()) + &quot;]&quot;);</span>
<span class="nc" id="L943">						isValid = false;</span>
					}

<span class="fc" id="L946">					if (!FaceISOStandardsValidator.getInstance()</span>
<span class="pc bpc" id="L947" title="1 of 2 branches missed.">							.isValidQualityAlgorithmIdentifier(qualityBlock.getQualityAlgorithmIdentifier())) {</span>
<span class="nc" id="L948">						message.append(</span>
								&quot;&lt;BR&gt;Invalid Quality Algorithm Identifier for Face Modality, expected values between[0x0000 and 0xFFFF], but received input value[&quot;
<span class="nc" id="L950">										+ String.format(&quot;0x%04X&quot;, qualityBlock.getQualityAlgorithmIdentifier()) + &quot;]&quot;);</span>
<span class="nc" id="L951">						isValid = false;</span>
					}

<span class="pc bpc" id="L954" title="1 of 2 branches missed.">					if (!FaceISOStandardsValidator.getInstance().isValidQualityAlgorithmVendorIdentifier(</span>
<span class="fc" id="L955">							qualityBlock.getQualityAlgorithmVendorIdentifier())) {</span>
<span class="nc" id="L956">						message.append(</span>
								&quot;&lt;BR&gt;Invalid Quality Algorithm Vendor Identifier for Face Modality, expected values between[0x0000 and 0xFFFF], but received input value[&quot;
<span class="nc" id="L958">										+ String.format(&quot;0x%04X&quot;, qualityBlock.getQualityAlgorithmVendorIdentifier())</span>
										+ &quot;]&quot;);
<span class="nc" id="L960">						isValid = false;</span>
					}
				}
			}

<span class="pc bpc" id="L965" title="1 of 2 branches missed.">			if (!FaceISOStandardsValidator.getInstance().isValidNoOfLandmarkPoints(bdir.getNoOfLandMarkPoints())) {</span>
<span class="nc" id="L966">				message.append(</span>
						&quot;&lt;BR&gt;Invalid No Of Landmark Points for Face Modality, expected values between[0x0000 and 0xFFFF], but received input value[&quot;
<span class="nc" id="L968">								+ String.format(&quot;0x%04X&quot;, bdir.getNoOfLandMarkPoints()) + &quot;]&quot;);</span>
<span class="nc" id="L969">				isValid = false;</span>
			}

<span class="pc bpc" id="L972" title="1 of 2 branches missed.">			if (!FaceISOStandardsValidator.getInstance().isValidGender(bdir.getGender())) {</span>
<span class="nc" id="L973">				message.append(</span>
						&quot;&lt;BR&gt;Invalid Gender value for Face Modality, expected values[0x00, 0x01, 0x02, 0xFF], but received input value[&quot;
<span class="nc" id="L975">								+ String.format(&quot;0x%02X&quot;, bdir.getGender()) + &quot;]&quot;);</span>
<span class="nc" id="L976">				isValid = false;</span>
			}

<span class="pc bpc" id="L979" title="1 of 2 branches missed.">			if (!FaceISOStandardsValidator.getInstance().isValidEyeColour(bdir.getEyeColor())) {</span>
<span class="nc" id="L980">				message.append(</span>
						&quot;&lt;BR&gt;Invalid Eye Colour value for Face Modality, expected values between[{0x00 and 0x07}, {0xFF}], but received input value[&quot;
<span class="nc" id="L982">								+ String.format(&quot;0x%02X&quot;, bdir.getEyeColor()) + &quot;]&quot;);</span>
<span class="nc" id="L983">				isValid = false;</span>
			}

<span class="pc bpc" id="L986" title="1 of 2 branches missed.">			if (!FaceISOStandardsValidator.getInstance().isValidHairColour(bdir.getHairColor())) {</span>
<span class="nc" id="L987">				message.append(</span>
						&quot;&lt;BR&gt;Invalid Hair Colour Value for Face Modality, expected values between[{0x00 and 0x07}, {0xFF}], but received input value[&quot;
<span class="nc" id="L989">								+ String.format(&quot;0x%02X&quot;, bdir.getHairColor()) + &quot;]&quot;);</span>
<span class="nc" id="L990">				isValid = false;</span>
			}

<span class="pc bpc" id="L993" title="1 of 2 branches missed.">			if (!FaceISOStandardsValidator.getInstance().isValidSubjectHeight(bdir.getSubjectHeight())) {</span>
<span class="nc" id="L994">				message.append(</span>
						&quot;&lt;BR&gt;Invalid Subject Height Value for Face Modality, expected values between[0x00 and 0xFF], but received input value[&quot;
<span class="nc" id="L996">								+ String.format(&quot;0x%02X&quot;, bdir.getSubjectHeight()) + &quot;]&quot;);</span>
<span class="nc" id="L997">				isValid = false;</span>
			}

<span class="pc bpc" id="L1000" title="1 of 2 branches missed.">			if (!FaceISOStandardsValidator.getInstance().isValidFeatureMask(bdir.getFeaturesMask())) {</span>
<span class="nc" id="L1001">				message.append(</span>
						&quot;&lt;BR&gt;Invalid Features Mask Value for Face Modality, expected values between[0x000000 and 0xFFFFFF], but received input value[&quot;
<span class="nc" id="L1003">								+ String.format(&quot;0x%06X&quot;, bdir.getFeaturesMask()) + &quot;]&quot;);</span>
<span class="nc" id="L1004">				isValid = false;</span>
			}

<span class="pc bpc" id="L1007" title="1 of 2 branches missed.">			if (!FaceISOStandardsValidator.getInstance().isValidFeatureMask(bdir.getExpressionMask())) {</span>
<span class="nc" id="L1008">				message.append(</span>
						&quot;&lt;BR&gt;Invalid Expression Mask Value for Face Modality, expected values between[0x000000 and 0xFFFFFF], but received input value[&quot;
<span class="nc" id="L1010">								+ String.format(&quot;0x%06X&quot;, bdir.getExpressionMask()) + &quot;]&quot;);</span>
<span class="nc" id="L1011">				isValid = false;</span>
			}

<span class="pc bpc" id="L1014" title="1 of 2 branches missed.">			if (!FaceISOStandardsValidator.getInstance().isValidPoseAngle(bdir.getPoseAngle())) {</span>
<span class="nc" id="L1015">				message.append(&quot;&lt;BR&gt;Invalid Pose Angle Value for Face Modality&quot;);</span>
<span class="nc" id="L1016">				isValid = false;</span>
			}

<span class="pc bpc" id="L1019" title="1 of 2 branches missed.">			if (!FaceISOStandardsValidator.getInstance().isValidPoseAngleUncertainty(bdir.getPoseAngleUncertainty())) {</span>
<span class="nc" id="L1020">				message.append(&quot;&lt;BR&gt;Invalid Pose Angle Uncertainty Value for Face Modality&quot;);</span>
<span class="nc" id="L1021">				isValid = false;</span>
			}

<span class="pc bpc" id="L1024" title="1 of 2 branches missed.">			if (!FaceISOStandardsValidator.getInstance().isValidPoseAngleUncertainty(bdir.getPoseAngleUncertainty())) {</span>
<span class="nc" id="L1025">				message.append(&quot;&lt;BR&gt;Invalid Pose Angle Uncertainty Value for Face Modality&quot;);</span>
<span class="nc" id="L1026">				isValid = false;</span>
			}

			// Future Implemntation
<span class="pc bpc" id="L1030" title="1 of 2 branches missed.">			if (bdir.getNoOfLandMarkPoints() &gt; 0) {</span>
<span class="nc bnc" id="L1031" title="All 2 branches missed.">				for (LandmarkPoints landmarkPoints : bdir.getLandmarkPoints()) {</span>
<span class="nc" id="L1032">					if (!FaceISOStandardsValidator.getInstance()</span>
<span class="nc bnc" id="L1033" title="All 2 branches missed.">							.isValidLandmarkPointType(landmarkPoints.getLandmarkPointType())) {</span>
<span class="nc" id="L1034">						message.append(</span>
								&quot;&lt;BR&gt;Invalid Landmark Point Type for Face Modality, expected values between[0x00 and 0xFF], but received input value[&quot;
<span class="nc" id="L1036">										+ String.format(&quot;0x%02X&quot;, landmarkPoints.getLandmarkPointType()) + &quot;]&quot;);</span>
<span class="nc" id="L1037">						isValid = false;</span>
					}

<span class="nc bnc" id="L1040" title="All 2 branches missed.">					if (!FaceISOStandardsValidator.getInstance().isValidLandmarkPointCode(</span>
<span class="nc" id="L1041">							landmarkPoints.getLandmarkPointType(), landmarkPoints.getLandmarkPointCode())) {</span>
<span class="nc" id="L1042">						message.append(</span>
								&quot;&lt;BR&gt;Invalid Landmark Point Code for Face Modality, expected values between[0x00 and 0xFF], but received input value[&quot;
<span class="nc" id="L1044">										+ String.format(&quot;0x%02X&quot;, landmarkPoints.getLandmarkPointCode()) + &quot;]&quot;);</span>
<span class="nc" id="L1045">						isValid = false;</span>
					}

<span class="nc bnc" id="L1048" title="All 2 branches missed.">					if (!FaceISOStandardsValidator.getInstance().isValidLandmarkXCooridinate(</span>
<span class="nc" id="L1049">							landmarkPoints.getLandmarkPointType(), landmarkPoints.getLandmarkPointCode(),</span>
<span class="nc" id="L1050">							landmarkPoints.getXCoordinate())) {</span>
<span class="nc" id="L1051">						message.append(</span>
								&quot;&lt;BR&gt;Invalid Landmark X Cooridinate for Face Modality, expected values between[0x0000 and 0xFFFF], but received input value[&quot;
<span class="nc" id="L1053">										+ String.format(&quot;0x%04X&quot;, landmarkPoints.getXCoordinate()) + &quot;]&quot;);</span>
<span class="nc" id="L1054">						isValid = false;</span>
					}

<span class="nc bnc" id="L1057" title="All 2 branches missed.">					if (!FaceISOStandardsValidator.getInstance().isValidLandmarkYCooridinate(</span>
<span class="nc" id="L1058">							landmarkPoints.getLandmarkPointType(), landmarkPoints.getLandmarkPointCode(),</span>
<span class="nc" id="L1059">							landmarkPoints.getYCoordinate())) {</span>
<span class="nc" id="L1060">						message.append(</span>
								&quot;&lt;BR&gt;Invalid Landmark Y Cooridinate for Face Modality, expected values between[0x0000 and 0xFFFF], but received input value[&quot;
<span class="nc" id="L1062">										+ String.format(&quot;0x%04X&quot;, landmarkPoints.getYCoordinate()) + &quot;]&quot;);</span>
<span class="nc" id="L1063">						isValid = false;</span>
					}

<span class="nc bnc" id="L1066" title="All 2 branches missed.">					if (!FaceISOStandardsValidator.getInstance().isValidLandmarkZCooridinate(</span>
<span class="nc" id="L1067">							landmarkPoints.getLandmarkPointType(), landmarkPoints.getLandmarkPointCode(),</span>
<span class="nc" id="L1068">							landmarkPoints.getZCoordinate())) {</span>
<span class="nc" id="L1069">						message.append(</span>
								&quot;&lt;BR&gt;Invalid Landmark Z Cooridinate for Face Modality, expected values between[0x0000 and 0xFFFF], but received input value[&quot;
<span class="nc" id="L1071">										+ String.format(&quot;0x%04X&quot;, landmarkPoints.getZCoordinate()) + &quot;]&quot;);</span>
<span class="nc" id="L1072">						isValid = false;</span>
					}
				}
			}

<span class="pc bpc" id="L1077" title="1 of 2 branches missed.">			if (!FaceISOStandardsValidator.getInstance().isValidFaceImageType(bdir.getFaceImageType())) {</span>
<span class="nc" id="L1078">				message.append(</span>
						&quot;&lt;BR&gt;Invalid Face Image Type Value for Face Modality, expected values between[{0x00 and 0x03}, {0x80 and 0x82}], but received input value[&quot;
<span class="nc" id="L1080">								+ String.format(&quot;0x%02X&quot;, bdir.getFaceImageType()) + &quot;]&quot;);</span>
<span class="nc" id="L1081">				isValid = false;</span>
			}

<span class="fc" id="L1084">			int compressionType = bdir.getImageDataType();</span>
<span class="pc bpc" id="L1085" title="2 of 4 branches missed.">			if (!(compressionType == ImageDataType.JPEG2000_LOSSY</span>
					|| compressionType == ImageDataType.JPEG2000_LOSS_LESS)) {
<span class="nc" id="L1087">				message.append(</span>
						&quot;&lt;BR&gt;Invalid Image Compression Type for Finger Modality, expected values[JPEG_2000_LOSSY(0x01), JPEG_2000_LOSS_LESS(0x02)], but received input value[&quot;
<span class="nc" id="L1089">								+ &quot;, (&quot; + String.format(&quot;0x%02X&quot;, compressionType) + &quot;)]&quot;);</span>
<span class="nc" id="L1090">				isValid = false;</span>
			}

<span class="fc" id="L1093">			byte[] inImageData = bdir.getImage();</span>

<span class="fc" id="L1095">			bqatRequestDto.setModality(SDKContstant.MODALITY_FACE);</span>
<span class="fc" id="L1096">			bqatRequestDto.setId(SDKContstant.MODALITY_FACE + &quot;_&quot;+ System.currentTimeMillis());</span>
<span class="fc" id="L1097">			bqatRequestDto.setType(SDKContstant.DATATYPE_JP2);</span>
<span class="fc" id="L1098">			bqatRequestDto.setData(Utils.encodeToURLSafeBase64(inImageData));</span>
			
<span class="fc" id="L1100">			if (!FaceISOStandardsValidator.getInstance()</span>
<span class="pc bpc" id="L1101" title="1 of 2 branches missed.">					.isValidSpatialSamplingRateLevel(bdir.getSpatialSamplingRateLevel())) {</span>
<span class="nc" id="L1102">				message.append(</span>
						&quot;&lt;BR&gt;Invalid Spatial Sampling Rate Level Value for Face Modality, expected values between[0x00 and 0x07], but received input value[&quot;
<span class="nc" id="L1104">								+ String.format(&quot;0x%02X&quot;, bdir.getSpatialSamplingRateLevel()) + &quot;]&quot;);</span>
<span class="nc" id="L1105">				isValid = false;</span>
			}

<span class="fc" id="L1108">			if (!FaceISOStandardsValidator.getInstance()</span>
<span class="pc bpc" id="L1109" title="1 of 2 branches missed.">					.isValidPostAcquisitionProcessing(bdir.getPostAcquistionProcessing())) {</span>
<span class="nc" id="L1110">				message.append(</span>
						&quot;&lt;BR&gt;Invalid Post Acquisition Processing Value for Face Modality, expected values between[0x0000 and 0xFFFF], but received input value[&quot;
<span class="nc" id="L1112">								+ String.format(&quot;0x%02X&quot;, bdir.getPostAcquistionProcessing()) + &quot;]&quot;);</span>
<span class="nc" id="L1113">				isValid = false;</span>
			}

<span class="pc bpc" id="L1116" title="1 of 2 branches missed.">			if (!FaceISOStandardsValidator.getInstance().isValidCrossReference(bdir.getCrossReference())) {</span>
<span class="nc" id="L1117">				message.append(</span>
						&quot;&lt;BR&gt;Invalid Cross Reference  Value for Face Modality, expected values between[0x00 and 0xFF], but received input value[&quot;
<span class="nc" id="L1119">								+ String.format(&quot;0x%02X&quot;, bdir.getCrossReference()) + &quot;]&quot;);</span>
<span class="nc" id="L1120">				isValid = false;</span>
			}

<span class="pc bpc" id="L1123" title="1 of 2 branches missed.">			if (!(bdir.getImageColorSpace() == ImageColourSpace.BIT_24_RGB)) {</span>
<span class="nc" id="L1124">				message.append(</span>
						&quot;&lt;BR&gt;Invalid Image Bit Depth Value for Face Modality, expected values[0x01], but received input value[&quot;
<span class="nc" id="L1126">								+ String.format(&quot;0x%02X&quot;, bdir.getImageColorSpace()) + &quot;]&quot;);</span>
<span class="nc" id="L1127">				isValid = false;</span>
			}

<span class="pc bpc" id="L1130" title="1 of 2 branches missed.">			if (!FaceISOStandardsValidator.getInstance().isValidImageDataLength(inImageData, bdir.getImageLength())) {</span>
<span class="nc" id="L1131">				message.append(</span>
						&quot;&lt;BR&gt;Invalid Image Data Length for Face Modality, expected values between[0x00000001 and 0xFFFFFFFF], but received input value[&quot;
<span class="nc" id="L1133">								+ String.format(&quot;0x%08X&quot;, bdir.getImageLength()) + &quot;]&quot;);</span>
<span class="nc" id="L1134">				isValid = false;</span>
			}

			// TODO check the condition: imagedata
<span class="pc bpc" id="L1138" title="1 of 2 branches missed.">			if (!isValid) {</span>
<span class="nc" id="L1139">				responseStatus = ResponseStatus.INVALID_INPUT;</span>
<span class="nc" id="L1140">				throw new BqatSdkException(responseStatus.getStatusCode() + &quot;&quot;,</span>
<span class="nc" id="L1141">						responseStatus.getStatusMessage() + &quot; &quot; + message.toString());</span>
			}
<span class="fc" id="L1143">			return true;</span>
<span class="nc" id="L1144">		} catch (Exception ex) {</span>
<span class="nc" id="L1145">			responseStatus = ResponseStatus.INVALID_INPUT;</span>
<span class="nc" id="L1146">			throw new BqatSdkException(responseStatus.getStatusCode() + &quot;&quot;,</span>
<span class="nc" id="L1147">					responseStatus.getStatusMessage() + &quot; &quot; + ex.getLocalizedMessage());</span>
		}
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>