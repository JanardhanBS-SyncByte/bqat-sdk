<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>BqatController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">bqatsdk-services</a> &gt; <a href="index.source.html" class="el_package">io.bqat.sdk.services.controller</a> &gt; <span class="el_source">BqatController.java</span></div><h1>BqatController.java</h1><pre class="source lang-java linenums">package io.bqat.sdk.services.controller;

import com.google.gson.Gson;
import com.google.gson.GsonBuilder;

import io.bqat.sdk.services.dto.ErrorDto;
import io.bqat.sdk.services.dto.RequestDto;
import io.bqat.sdk.services.dto.ResponseDto;
import io.bqat.sdk.services.constant.ErrorMessages;
import io.bqat.sdk.services.exceptions.BqatSdkException;
import io.bqat.sdk.services.factory.BqatSdkServiceFactory;
import io.bqat.sdk.services.service.CheckQualityService;
import io.bqat.sdk.services.spi.BqatSdkServiceProvider;
import io.bqat.sdk.services.utils.Utils;
import io.mosip.kernel.biometrics.spi.IBioApiV2;
import io.mosip.kernel.core.logger.spi.Logger;
import io.swagger.annotations.Api;
import io.swagger.annotations.ApiOperation;
import io.swagger.annotations.ApiResponse;
import io.swagger.annotations.ApiResponses;
import lombok.extern.slf4j.Slf4j;

import org.json.simple.JSONObject;
import org.json.simple.parser.JSONParser;
import org.json.simple.parser.ParseException;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.HttpStatus;
import org.springframework.http.MediaType;
import org.springframework.http.ResponseEntity;
import org.springframework.security.access.prepost.PreAuthorize;
import org.springframework.validation.Errors;
import org.springframework.validation.annotation.Validated;
import org.springframework.web.bind.annotation.*;
import springfox.documentation.annotations.ApiIgnore;

import java.util.ArrayList;
import java.util.Date;

import static io.bqat.sdk.services.constant.AppConstants.LOGGER_IDTYPE;
import static io.bqat.sdk.services.constant.AppConstants.LOGGER_SESSIONID;

@RestController
@RequestMapping(&quot;/&quot;)
@Api(tags = &quot;Sdk&quot;)
@CrossOrigin(&quot;*&quot;)
<span class="nc" id="L46">@Slf4j</span>
<span class="nc" id="L47">public class BqatController {</span>

	@Autowired
	private Utils serviceUtil;

	@Autowired
	private IBioApiV2 iBioApi;

	@Autowired
	private BqatSdkServiceFactory bqatSdkServiceFactory;

<span class="nc" id="L58">	private Gson gson = new GsonBuilder().serializeNulls().create();</span>

	@GetMapping(path = &quot;/&quot;)
	@ApiOperation(value = &quot;Service status&quot;)
	@ApiResponses(value = { @ApiResponse(code = 200, message = &quot;Service is running...&quot;) })
	public ResponseEntity&lt;String&gt; status() {
<span class="nc" id="L64">		Date d = new Date();</span>
<span class="nc" id="L65">		return ResponseEntity.status(HttpStatus.OK).body(&quot;Service is running... &quot; + d.toString());</span>
	}

	@PreAuthorize(&quot;hasAnyRole('BQAT_BIOMETRIC_QUALITY_PROCESSOR')&quot;)
	@GetMapping(path = &quot;/s&quot;)
	@ApiOperation(value = &quot;Service status 1&quot;)
	@ApiResponses(value = { @ApiResponse(code = 200, message = &quot;Service is running...&quot;) })
	public ResponseEntity&lt;String&gt; status1() {
<span class="nc" id="L73">		Date d = new Date();</span>
<span class="nc" id="L74">		return ResponseEntity.status(HttpStatus.OK).body(&quot;Service is running... &quot; + d.toString());</span>
	}

	@PostMapping(path = &quot;/init&quot;, consumes = MediaType.APPLICATION_JSON_VALUE, produces = MediaType.APPLICATION_JSON_VALUE)
	@ApiOperation(value = &quot;Initialization&quot;)
	@ApiResponses(value = { @ApiResponse(code = 200, message = &quot;Initialization successful&quot;) })
	public ResponseEntity&lt;String&gt; init(@Validated @RequestBody(required = true) RequestDto request,
			@ApiIgnore Errors errors) {
<span class="nc" id="L82">		ResponseDto responseDto = generateResponseTemplate(request.getVersion());</span>
		try {
<span class="nc" id="L84">			responseDto.setVersion(request.getVersion());</span>
<span class="nc" id="L85">			BqatSdkServiceProvider bioSdkServiceProviderImpl = null;</span>
<span class="nc" id="L86">			bioSdkServiceProviderImpl = bqatSdkServiceFactory.getBioSdkServiceProvider(request.getVersion());</span>
<span class="nc" id="L87">			responseDto.setResponse(bioSdkServiceProviderImpl.init(request));</span>
<span class="nc" id="L88">		} catch (BqatSdkException e) {</span>
<span class="nc" id="L89">			log.error(LOGGER_SESSIONID, LOGGER_IDTYPE, &quot;BqatSdkException: &quot;, e.getMessage());</span>
<span class="nc" id="L90">			ErrorDto errorDto = new ErrorDto(e.getErrorCode(), e.getErrorText());</span>
<span class="nc" id="L91">			responseDto.getErrors().add(errorDto);</span>
<span class="nc" id="L92">			return ResponseEntity.status(HttpStatus.OK).body(gson.toJson(responseDto));</span>
<span class="nc" id="L93">		}</span>
<span class="nc" id="L94">		return ResponseEntity.status(HttpStatus.OK).body(gson.toJson(responseDto));</span>
	}

	@PostMapping(path = &quot;/match&quot;, consumes = MediaType.APPLICATION_JSON_VALUE, produces = MediaType.APPLICATION_JSON_VALUE)
	@ApiOperation(value = &quot;Match&quot;)
	@ApiResponses(value = { @ApiResponse(code = 200, message = &quot;Match successful&quot;) })
	public ResponseEntity&lt;String&gt; match(@Validated @RequestBody(required = true) RequestDto request,
			@ApiIgnore Errors errors) {
<span class="nc" id="L102">		ResponseDto responseDto = generateResponseTemplate(request.getVersion());</span>
		try {
<span class="nc" id="L104">			responseDto.setVersion(request.getVersion());</span>
<span class="nc" id="L105">			BqatSdkServiceProvider bioSdkServiceProviderImpl = null;</span>
<span class="nc" id="L106">			bioSdkServiceProviderImpl = bqatSdkServiceFactory.getBioSdkServiceProvider(request.getVersion());</span>
<span class="nc" id="L107">			responseDto.setResponse(bioSdkServiceProviderImpl.match(request));</span>
<span class="nc" id="L108">		} catch (BqatSdkException e) {</span>
<span class="nc" id="L109">			log.error(LOGGER_SESSIONID, LOGGER_IDTYPE, &quot;BqatSdkException: &quot;, e.getMessage());</span>
<span class="nc" id="L110">			ErrorDto errorDto = new ErrorDto(e.getErrorCode(), e.getErrorText());</span>
<span class="nc" id="L111">			responseDto.getErrors().add(errorDto);</span>
<span class="nc" id="L112">			return ResponseEntity.status(HttpStatus.OK).body(gson.toJson(responseDto));</span>
<span class="nc" id="L113">		}</span>
<span class="nc" id="L114">		return ResponseEntity.status(HttpStatus.OK).body(gson.toJson(responseDto));</span>
	}

	@PostMapping(path = &quot;/check-quality&quot;, consumes = MediaType.APPLICATION_JSON_VALUE, produces = MediaType.APPLICATION_JSON_VALUE)
	@ApiOperation(value = &quot;Check quality&quot;)
	@ApiResponses(value = { @ApiResponse(code = 200, message = &quot;Check successful&quot;) })
	public ResponseEntity&lt;String&gt; checkQuality(@Validated @RequestBody(required = true) RequestDto request,
			@ApiIgnore Errors errors) {
<span class="nc" id="L122">		ResponseDto responseDto = generateResponseTemplate(request.getVersion());</span>
		try {
<span class="nc" id="L124">			responseDto.setVersion(request.getVersion());</span>
<span class="nc" id="L125">			BqatSdkServiceProvider bioSdkServiceProviderImpl = null;</span>
<span class="nc" id="L126">			bioSdkServiceProviderImpl = bqatSdkServiceFactory.getBioSdkServiceProvider(request.getVersion());</span>
<span class="nc" id="L127">			responseDto.setResponse(bioSdkServiceProviderImpl.checkQuality(request));</span>
<span class="nc" id="L128">		} catch (BqatSdkException e) {</span>
<span class="nc" id="L129">			log.error(LOGGER_SESSIONID, LOGGER_IDTYPE, &quot;BqatSdkException: &quot;, e.getMessage());</span>
<span class="nc" id="L130">			ErrorDto errorDto = new ErrorDto(e.getErrorCode(), e.getErrorText());</span>
<span class="nc" id="L131">			responseDto.getErrors().add(errorDto);</span>
<span class="nc" id="L132">			return ResponseEntity.status(HttpStatus.OK).body(gson.toJson(responseDto));</span>
<span class="nc" id="L133">		}</span>
<span class="nc" id="L134">		log.info(LOGGER_SESSIONID, LOGGER_IDTYPE, &quot;checkQuality: Ended&quot;);</span>
<span class="nc" id="L135">		return ResponseEntity.status(HttpStatus.OK).body(gson.toJson(responseDto));</span>
	}

	@PostMapping(path = &quot;/extract-template&quot;, consumes = MediaType.APPLICATION_JSON_VALUE, produces = MediaType.APPLICATION_JSON_VALUE)
	@ApiOperation(value = &quot;Extract template&quot;)
	@ApiResponses(value = { @ApiResponse(code = 200, message = &quot;Extract successful&quot;) })
	public ResponseEntity&lt;String&gt; extractTemplate(@Validated @RequestBody(required = true) RequestDto request,
			@ApiIgnore Errors errors) {
<span class="nc" id="L143">		ResponseDto responseDto = generateResponseTemplate(request.getVersion());</span>
		try {
<span class="nc" id="L145">			responseDto.setVersion(request.getVersion());</span>
<span class="nc" id="L146">			BqatSdkServiceProvider bioSdkServiceProviderImpl = null;</span>
<span class="nc" id="L147">			bioSdkServiceProviderImpl = bqatSdkServiceFactory.getBioSdkServiceProvider(request.getVersion());</span>
<span class="nc" id="L148">			responseDto.setResponse(bioSdkServiceProviderImpl.extractTemplate(request));</span>
<span class="nc" id="L149">		} catch (BqatSdkException e) {</span>
<span class="nc" id="L150">			log.error(LOGGER_SESSIONID, LOGGER_IDTYPE, &quot;BqatSdkException: &quot;, e.getMessage());</span>
<span class="nc" id="L151">			ErrorDto errorDto = new ErrorDto(e.getErrorCode(), e.getErrorText());</span>
<span class="nc" id="L152">			responseDto.getErrors().add(errorDto);</span>
<span class="nc" id="L153">			return ResponseEntity.status(HttpStatus.OK).body(gson.toJson(responseDto));</span>
<span class="nc" id="L154">		}</span>
<span class="nc" id="L155">		return ResponseEntity.status(HttpStatus.OK).body(gson.toJson(responseDto));</span>
	}

	@PostMapping(path = &quot;/convert-format&quot;, consumes = MediaType.APPLICATION_JSON_VALUE, produces = MediaType.APPLICATION_JSON_VALUE)
	@ApiOperation(value = &quot;Convert format&quot;)
	@ApiResponses(value = { @ApiResponse(code = 200, message = &quot;Convert successful&quot;) })
	public ResponseEntity&lt;String&gt; convertFormat(@Validated @RequestBody(required = true) RequestDto request,
			@ApiIgnore Errors errors) {
<span class="nc" id="L163">		ResponseDto responseDto = generateResponseTemplate(request.getVersion());</span>
		try {
<span class="nc" id="L165">			responseDto.setVersion(request.getVersion());</span>
<span class="nc" id="L166">			BqatSdkServiceProvider bioSdkServiceProviderImpl = null;</span>
<span class="nc" id="L167">			bioSdkServiceProviderImpl = bqatSdkServiceFactory.getBioSdkServiceProvider(request.getVersion());</span>
<span class="nc" id="L168">			responseDto.setResponse(bioSdkServiceProviderImpl.convertFormat(request));</span>
<span class="nc" id="L169">		} catch (BqatSdkException e) {</span>
<span class="nc" id="L170">			log.error(LOGGER_SESSIONID, LOGGER_IDTYPE, &quot;BqatSdkException: &quot;, e.getMessage());</span>
<span class="nc" id="L171">			ErrorDto errorDto = new ErrorDto(e.getErrorCode(), e.getErrorText());</span>
<span class="nc" id="L172">			responseDto.getErrors().add(errorDto);</span>
<span class="nc" id="L173">			return ResponseEntity.status(HttpStatus.OK).body(gson.toJson(responseDto));</span>
<span class="nc" id="L174">		}</span>
<span class="nc" id="L175">		return ResponseEntity.status(HttpStatus.OK).body(gson.toJson(responseDto));</span>
	}

	@PostMapping(path = &quot;/segment&quot;, consumes = MediaType.APPLICATION_JSON_VALUE, produces = MediaType.APPLICATION_JSON_VALUE)
	@ApiOperation(value = &quot;Segment&quot;)
	@ApiResponses(value = { @ApiResponse(code = 200, message = &quot;Segment successful&quot;) })
	public ResponseEntity&lt;String&gt; segment(@Validated @RequestBody(required = true) RequestDto request,
			@ApiIgnore Errors errors) {
<span class="nc" id="L183">		ResponseDto responseDto = generateResponseTemplate(request.getVersion());</span>
		try {
<span class="nc" id="L185">			responseDto.setVersion(request.getVersion());</span>
<span class="nc" id="L186">			BqatSdkServiceProvider bioSdkServiceProviderImpl = null;</span>
<span class="nc" id="L187">			bioSdkServiceProviderImpl = bqatSdkServiceFactory.getBioSdkServiceProvider(request.getVersion());</span>
<span class="nc" id="L188">			responseDto.setResponse(bioSdkServiceProviderImpl.segment(request));</span>
<span class="nc" id="L189">		} catch (BqatSdkException e) {</span>
<span class="nc" id="L190">			log.error(LOGGER_SESSIONID, LOGGER_IDTYPE, &quot;BqatSdkException: &quot;, e.getMessage());</span>
<span class="nc" id="L191">			ErrorDto errorDto = new ErrorDto(e.getErrorCode(), e.getErrorText());</span>
<span class="nc" id="L192">			responseDto.getErrors().add(errorDto);</span>
<span class="nc" id="L193">			return ResponseEntity.status(HttpStatus.OK).body(gson.toJson(responseDto));</span>
<span class="nc" id="L194">		}</span>
<span class="nc" id="L195">		return ResponseEntity.status(HttpStatus.OK).body(gson.toJson(responseDto));</span>
	}

	private ResponseDto generateResponseTemplate(String version) {
<span class="nc" id="L199">		ResponseDto responseDto = new ResponseDto();</span>
<span class="nc" id="L200">		responseDto.setVersion(version);</span>
<span class="nc" id="L201">		responseDto.setResponsetime(serviceUtil.getCurrentResponseTime());</span>
<span class="nc" id="L202">		responseDto.setErrors(new ArrayList&lt;ErrorDto&gt;());</span>
<span class="nc" id="L203">		responseDto.setResponse(&quot;&quot;);</span>
<span class="nc" id="L204">		return responseDto;</span>
	}

	private String getVersion(String request) throws BqatSdkException {
<span class="nc" id="L208">		JSONParser parser = new JSONParser();</span>
		try {
<span class="nc" id="L210">			JSONObject js = (JSONObject) parser.parse(request);</span>
<span class="nc" id="L211">			return js.get(&quot;version&quot;).toString();</span>
<span class="nc" id="L212">		} catch (ParseException e) {</span>
<span class="nc" id="L213">			throw new BqatSdkException(ErrorMessages.UNCHECKED_EXCEPTION.toString(), e.getMessage());</span>
		}
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.5.201910111838</span></div></body></html>